function kInteractionStart(){this.log=function(e){},kInteractive.setDOMParser(),kInteractive.preRender(),kInteractive.postRender()}function kInteractionStartSingleElem(e){kInteractive.setDOMParser(),kInteractive.preRender(e,!0),kInteractive.postRender(e,!0)}var kInteractive={scormWrapper:null,preRender:function(e,t){new DOMParser;var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"gallery")){var o=i.createDocumentFragment(),s=kInteractive.readData(r);if(!s)continue;r.innerHTML="";var c=document.createElement("div");c.className="imgMask";var l=document.createElement("div");l.className="images "+s.scale,c.appendChild(l);for(N=0;N<s.imgs.length;N++){var d=document.createElement("div");d.className="imgContainer"+(N?"":" selected");G="undefined"==typeof isKotobee?s.imgs[N].path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,s.imgs[N].path);d.setAttribute("style","background-color:"+s.bgColor+";background-image:url('"+G+"')"+(N?"":";display:block")),s.imgs[N].caption&&d.setAttribute("data-caption",s.imgs[N].caption),l.appendChild(d)}o.appendChild(c);var u=document.createElement("div");u.className="imgCaption";var m=document.createElement("div");m.className="inner",s.imgs[0]&&s.imgs[0].caption&&(m.innerHTML=s.imgs[0].caption),u.appendChild(m),o.appendChild(u);var p=document.createElement("a");p.className="next btn ki-btn",1==s.imgs.length&&(p.className+=" disable"),o.appendChild(p);var h=document.createElement("a");h.className="prev btn ki-btn disable",o.appendChild(h),"undefined"==typeof isKotobee&&(p.addEventListener("click",this.actionEvent),h.addEventListener("click",this.actionEvent));Y=document.createElement("div");s.style&&kInteractive.c.addClass(Y,s.style),Y.appendChild(o),r.appendChild(Y)}if(this.hasClass(r,"questions")){var o=i.createDocumentFragment(),v=kInteractive.readData(r);if(!v)continue;var f=v.dict,g=v.userDict;f||(f={}),g||(g=f),v.options||(v.options={}),r.id||(r.id="ki-qs-"+a+"-"+Math.ceil(1e3*Math.random()));if(r.innerHTML="",v.layout&&v.layout.popup&&!this.hasClass(r,"inpopup")){var y=document.createElement("img"),b=v.layout.popupImg;y.src=b,o.appendChild(y),"undefined"==typeof isKotobee&&y.addEventListener("click",this.actionEvent),r.appendChild(o);continue}if(v.options.randomize){for(N=0;N<v.q.length;N++)v.q[N].origin=N;for(var k,I,C=v.q.length;0!==C;)I=Math.floor(Math.random()*C),C-=1,k=v.q[C],v.q[C]=v.q[I],v.q[I]=k}if(v.options.questionsDisplayed){var E=Number(v.options.questionsDisplayed);v.q=v.q.slice(0,E)}if(v.title){var w=document.createElement("span");w.innerHTML="<h4>"+kInteractive.escapeHtml(v.title)+"</h4>",o.appendChild(w)}for(var N=0;N<v.q.length;N++){var A=v.q[N],x=document.createElement("div");if(x.className="ques",null!=A.origin&&x.setAttribute("data-o",A.origin),x.innerHTML="<p><strong><span class='no'>"+(N+1)+"</span> "+kInteractive.escapeHtml(A.q)+"</strong></p>",A.path){var T=document.createElement("img");T.src=A.path,x.appendChild(T)}if("sa"==A.type){var L=A.lines?A.lines:1,q=document.createElement(L>1?"textarea":"input");q.name="sa-"+N,1==L?q.type="text":q.rows=A.lines?A.lines:1,q.className="ans txtfield";M="ki-sa-"+a+"-"+N;q.id=M,document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[N]&&(q.value=document[r.id].q[N]),x.appendChild(q)}else if("mcq"==A.type||"mmcq"==A.type)for(var B=A.c,H=0;H<B.length;H++){var M="ki-mcq-"+a+"-"+N+"-"+H,S=document.createElement("input");"mmcq"==A.type?(S.name="name",S.type="checkbox"):(S.name="mcq-"+N,S.type="radio"),S.className="ans",S.id=M,(_=document.createElement("label")).htmlFor=M,_.innerHTML=" "+kInteractive.escapeHtml(B[H].t)+"<br/>",_.className="ki-noHighlight",(O=document.createElement("div")).className="answer",document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[N]&&(S.checked=document[r.id].q[N][H],v.options&&v.options.highlightCorrect&&v.q[N].c[H].a&&kInteractive.c.addClass(O,"correct")),O.appendChild(S),O.appendChild(_),x.appendChild(O)}else if("tf"==A.type)for(H=0;H<2;H++){var M="ki-tf-"+a+"-"+N+"-"+H,R=document.createElement("input");R.type="radio",R.name="tf-"+N,R.className="ans",R.id=M,(_=document.createElement("label")).htmlFor=M,A.choice1&&A.choice2?_.innerHTML=kInteractive.escapeHtml(" "+(0==H?A.choice1:A.choice2)):_.innerHTML=" "+(0==H?"True":"False"),_.className="ki-noHighlight";var O=document.createElement("div");document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[N]&&(R.checked=document[r.id].q[N][H],v.options&&v.options.highlightCorrect&&(0==H&&v.q[N].a||1==H&&!v.q[N].a)&&kInteractive.c.addClass(O,"correct")),O.appendChild(R),O.appendChild(_),x.appendChild(O)}if((V=document.createElement("p")).className="separator",x.appendChild(V),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[N]){if(v.q[N].exp&&!x.getElementsByClassName("explanation").length){var D=document.createElement("p");D.className="explanation",D.innerHTML=kInteractive.escapeHtml(v.q[N].exp),kInteractive.appendAfterDelay(x,D)}if(v.q[N].ref&&!x.getElementsByClassName("reference").length){var F=document.createElement("a");F.className="reference",F.innerHTML=g.learnMode?g.learnMode:"Learn more",F.setAttribute("href",kInteractive.escapeHtml(v.q[N].ref)),F.setAttribute("target","_blank"),kInteractive.appendAfterDelay(x,F)}}o.appendChild(x)}if(v.options.emailForm){var z=document.createElement("div");z.setAttribute("class","emailForm"),function(e,t,n){var i=document.createElement("div");i.className="address",i.innerHTML="<p><strong>"+e+"</strong><em>"+t+"</em></p>";var a=document.createElement("input");a.name=n,a.type="text",a.className="txtfield",i.appendChild(a);var r=document.createElement("p");r.className="separator",i.appendChild(r),z.appendChild(i)}(g.recipientEmail?g.recipientEmail:"Recipient email",g.separateEmails?g.separateEmails:"Separate multiple emails with commas","recipientEmail"),o.appendChild(z)}var j=null;if("none"!=v.action){var P="ki-"+a+"-btn";(j=document.createElement("input")).type="submit",j.value=g.submit?g.submit:"Submit Answers",j.id=P,j.className="btn ki-btn ki-mcq"}var K=null,W=null;if(v.options&&(v.options.clearAnswers&&((K=document.createElement("input")).type="submit",K.value=g.clear?g.clear:"Clear Answers",K.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&K.addEventListener("click",this.actionEvent)),v.options.addToNotebook&&((K=document.createElement("input")).type="submit",K.value=g.notebook?g.notebook:"Save to Notebook",K.className="btn ki-btn ki-questions questions-notebook","undefined"==typeof isKotobee&&K.addEventListener("click",this.actionEvent)),v.options.preserveAnswers)){(W=document.createElement("div")).style.marginTop="5px";var U=document.createElement("input");U.type="checkbox",U.name="preserveAnswers",U.className="ki-btn ki-questions questions-preserve",U.id="ki-"+a+"-preserveAnswersBtn",document[r.id]&&(U.checked=document[r.id].preserve),W.appendChild(U);var _=document.createElement("label");_.htmlFor=U.id,_.innerHTML=" "+(g.preserve?g.preserve:"Preserve submitted answers"),_.className="ki-noHighlight",W.appendChild(_),"undefined"==typeof isKotobee&&U.addEventListener("change",this.actionEvent)}"undefined"==typeof isKotobee&&j&&j.addEventListener("click",this.actionEvent),j&&o.appendChild(j),o.appendChild(document.createTextNode(" ")),K&&o.appendChild(K),W&&o.appendChild(W);var V=document.createElement("p");V.className="separator",o.appendChild(V),v.options.rtl?(r.style.direction="rtl",kInteractive.c.addClass(r,"rtl")):r.style.direction="ltr";var Y=document.createElement("div");v.style&&kInteractive.c.addClass(Y,v.style),Y.appendChild(o),r.appendChild(Y)}if(this.hasClass(r,"image")){if(r.parentNode&&this.hasClass(r.parentNode,"link"))continue;"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}if(this.hasClass(r,"link")){var Q=kInteractive.readData(r);if(!Q)continue;if("undefined"!=typeof editorMode&&editorMode)continue;if("div"==r.nodeName.toLowerCase()){var J=document.createElement("a");J.setAttribute("href","popup"==Q.type?"":r.getAttribute("href")),J.setAttribute("target",Q.target),J.setAttribute("style",r.getAttribute("style")),J.setAttribute("data-kotobee",r.getAttribute("data-kotobee")),J.className="kInteractive link btn",J.style.opacity=Number(Q.transparency)/100,r.parentNode.replaceChild(J,r),r=J}"undefined"==typeof isKotobee&&("popup"!=Q.type&&"audio"!=Q.type||r.setAttribute("onclick","return false;"),r.addEventListener("click",this.actionEvent))}if(this.hasClass(r,"container")){var X=kInteractive.readData(r);if(!X)continue;if(X.path){var G=X.path;"undefined"!=typeof isKotobee&&(G=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,X.path));var $=r.getAttribute("style");r.setAttribute("style",$+' background-image:url("'+G+'");')}kInteractive.isMobile()&&(r.style.minHeight=r.style.height,r.style.height="auto",r.style.overflowY=null)}}},clearAudioVideo:function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),i=n.length;i--;)try{if(n[i].hasAttribute("data-dontclose"))continue;n[i].pause(),n[i].children.length||(n[i].src="")}catch(e){}for(var a=t.getElementsByTagName("video"),i=a.length;i--;)a[i].pause(),a[i].children.length||(a[i].src="")},postRender:function(e,t){kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.currentVideo=kInteractive.currentAudio=null,kInteractive.clearAudioVideo(e);var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"questions")){var o=kInteractive.readData(r);if(!o)continue;var s=o.dict,c=o.userDict;s||(s={}),c||(c=s);for(var l=r.getElementsByClassName("ques"),d=r.getElementsByClassName("explanation"),u=d.length;u--;)d[u].parentNode.removeChild(d[u]);for(var m=r.getElementsByClassName("reference"),u=m.length;u--;)m[u].parentNode.removeChild(m[u]);for(var p=0;p<l.length;p++){var h=l[p].getElementsByClassName("ans"),v=(h.length,p);if(o.options.randomize&&(v=Number(l[p].getAttribute("data-o"))),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]){if(o.q[v].exp&&!l[p].getElementsByClassName("explanation").length){var f=document.createElement("p");f.className="explanation",f.innerHTML=kInteractive.escapeHtml(o.q[v].exp),kInteractive.appendAfterDelay(l[p],f)}if(o.q[v].ref&&!l[p].getElementsByClassName("reference").length){var g=document.createElement("a");g.className="reference",g.innerHTML=c.learnMode?c.learnMode:"Learn more",g.setAttribute("href",kInteractive.escapeHtml(o.q[v].ref)),g.setAttribute("target","_blank"),kInteractive.appendAfterDelay(l[p],g)}}for(u=0;u<h.length;u++)kInteractive.c.removeClass(h[u].parentNode,"correct"),h[u].getAttribute("id").indexOf("ki-tf-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].checked=document[r.id].q[v][u],o.options&&o.options.highlightCorrect&&(0==u&&o.q[v].a||1==u&&!o.q[v].a)&&kInteractive.c.addClass(h[u].parentNode,"correct")):h[u].getAttribute("id").indexOf("ki-sa-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].value=document[r.id].q[v]):document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].checked=document[r.id].q[v][u],o.options&&o.options.highlightCorrect&&o.q[v].c[u].a&&kInteractive.c.addClass(h[u].parentNode,"correct"));if(document[r.id]){var y=r.getElementsByClassName("questions-preserve");y.length&&(y[0].checked=document[r.id].preserve)}}}else if(this.hasClass(r,"widget")){var b=i.createDocumentFragment(),k=kInteractive.readData(r);if(!k)continue;var I=k.name,C=k.src,E=k.width,w=k.height;if("page"==k.mode){if(r.children.length)continue;var N=document.createElement("div");N.className="cover",b.appendChild(N),k.interaction&&(N.style.pointerEvents="none");var A=document.createElement("div");A.className="iframeContainer";var x=document.createElement("iframe");x.setAttribute("nwdisable","true"),x.setAttribute("nwfaketop","true"),x.setAttribute("width",r.style.width?r.style.width:E+k.widthUnit),x.setAttribute("height",r.style.height?r.style.height:w+"px"),x.src=kInteractive.getWidgetUrl(k),A.appendChild(x),b.appendChild(A);var T=r.style.width,L=r.style.height;T.indexOf("px")>=0&&(k.widthUnit="px"),T.indexOf("%")>=0&&(k.widthUnit="%");try{k.widthUnit?k.width=Number(T.split(k.widthUnit)[0]):k.width=Number(T)}catch(e){k.width=Number(T)}try{k.height=Number(L.split("px")[0])}catch(e){k.height=Number(L)}kInteractive.writeData(r,k)}else{if(r.setAttribute("wdgt-src",C),r.setAttribute("wdgt-name",I),!r.children.length&&!r.innerHTML.trim()){var q=document.createElement("img");q.src=kInteractive.getWidgetHome(k)+"/"+I+"/Icon.png",b.appendChild(q)}"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}r.appendChild(b)}else if(this.hasClass(r,"video")){var b=i.createDocumentFragment(),B=kInteractive.readData(r);if(!B)continue;var H="";if(B.splash&&(H="undefined"==typeof isKotobee?B.splash:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,B.splash)),H){r.style.backgroundImage=null;var M=r.style.cssText;r.setAttribute("style","background-image:url('"+H+"');"+M)}r.setAttribute("id","ki-video-"+a),r.innerHTML="",(R=document.createElement("div")).setAttribute("id","ki-video-"+a+"-container"),R.className="container";D=document.createElement("div");B.style&&kInteractive.c.addClass(D,B.style),(O=document.createElement("a")).className="playBtn ki-btn",O.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&O.addEventListener("click",this.actionEvent),b.appendChild(O),b.appendChild(R),D.appendChild(b),r.appendChild(D),B.autoplay&&kInteractive.action(r)}else if(this.hasClass(r,"audio")){var b=i.createDocumentFragment(),S=kInteractive.readData(r);r.setAttribute("id","ki-audio-"+a),r.innerHTML="";var R=document.createElement("div");R.setAttribute("id","ki-audio-"+a+"-container"),R.className="container";var O=document.createElement("a");O.className="playBtn ki-btn",O.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&O.addEventListener("click",this.actionEvent);var D=document.createElement("div");S.style&&kInteractive.c.addClass(D,S.style),b.appendChild(O),b.appendChild(R),D.appendChild(b),r.appendChild(D)}else if(this.hasClass(r,"threed")){var b=i.createDocumentFragment(),F=kInteractive.readData(r);if(!F)continue;r.innerHTML="";var z=r.getAttribute("style");F.inter.placeholderPath&&(z+="background-image:url('"+("undefined"==typeof isKotobee?F.inter.placeholderPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,F.inter.placeholderPath))+"');"),r.setAttribute("style",z);var j=document.createElement("a");F.inter.includeMsg?(j.innerHTML=kInteractive.escapeHtml(F.inter.msg),j.className="msgBtn ki-btn"):j.className="invisibleBtn ki-btn",b.appendChild(j),"undefined"==typeof isKotobee&&j&&j.addEventListener("click",this.actionEvent),r.appendChild(b)}else if(this.hasClass(r,"gallery"));else if(this.hasClass(r,"image")){var P=kInteractive.readData(r);if(!P)continue;P&&(P.behavior&&"none"!=P.behavior||(r.style.transition=r.style.webkitTransition=r.style.mozTransition="none"))}}this.firstRun&&(window.addEventListener("resize",function(n){kInteractive.resizeEvent(e,t)}),this.firstRun=!1),kInteractive.resizeEvent(e,t)},actionEvent:function(e){kInteractive.action(e.target)},action:function(e,t){function n(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}function i(){var e="Questions: "+v+". Score: "+g+" questions out of "+b;e+=". Action: "+K,"selfAnswerReport"==K&&(e+=". Details: "+k),kInteractive.tinCan({verb:"solved",activity:e})}function a(){de||(kInteractive.c.addClass(me,"hide"),de=!0)}function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function o(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function s(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}function c(e){var t=document.createElement("video");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("src",e),t.setAttribute("autoplay","true"),t.setAttribute("data-tap-disabled","false");var n;0!=e.indexOf("http://")&&0!=e.indexOf("https://")||(n=!0),n&&t.setAttribute("crossorigin","anonymous");var i=!1;try{i=navigator.userAgent.toLowerCase().indexOf("android")>-1}catch(e){}i||t.setAttribute("type","video/mp4"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("controls","true"),t.className="ki-noHighlight",Ae.hideDownloadBtn&&(t.className+=" hideDownloadBtn"),t.innerHTML="Your browser doesn't support HTML5 video.",n&&(t.crossOrigin="anonymous"),t.oncanplay=function(){kInteractive.currentVideo==d&&(Te.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},t.addEventListener("error",function(e){kInteractive.stopCurrentMedia()}),t.addEventListener("webkitfullscreenchange",function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t});var a=d.getElementsByClassName("container")[0];a.setAttribute("data-tap-disabled","true"),a.appendChild(t)}function l(){function e(e){function n(t){if(!(t>=Se.objects.length)){var i=Se.objects[t],r="undefined"==typeof isKotobee?i.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.path);new THREE.OBJLoader(l).load(r,function(r){Re&&Re.parentNode&&Re.parentNode.removeChild(Re),a.domElement.parentNode||e.appendChild(a.domElement),r.position.set(i.x,i.y,i.z),r.traverse(function(e){if(e instanceof THREE.Mesh){var a=e==r.children[r.children.length-1];if(i.textPath){var o=new THREE.ImageLoader(l),s="undefined"==typeof isKotobee?i.textPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.textPath);o.load(s,function(i){var o=new THREE.Texture;o.image=i,o.needsUpdate=!0,e.material.map=o,a&&c.add(r),n(++t)},function(){},function(e){})}else a&&c.add(r),n(++t)}})},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){})}}function i(){a.render(c,s);g.getDelta();t=requestAnimFrame(i)}kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("_3D",Se.name?Se.name:"Model"),e.description="Opened 3D model: "+(Se.name?Se.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800),t&&cancelAnimationFrame(t);var a;a=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?new THREE.WebGLRenderer({precision:"highp"}):new THREE.CanvasRenderer;var r=e.offsetWidth,o=e.offsetHeight,s=new THREE.PerspectiveCamera(Se.camera.viewAngle,r/o,Se.camera.near,Se.camera.far),c=new THREE.Scene;null!=Se.scene.bgColor&&a.setClearColor(Se.scene.bgColor,1),c.add(s),s.position.x=Se.camera.x,s.position.y=Se.camera.y,s.position.z=Se.camera.z,a.setSize(r,o),Se.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:Se.scene.floorColor?Se.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,c.add(floor));var l=new THREE.LoadingManager;l.onProgress=function(e,t,n){},n(0),new THREE.OrbitControls(s,a.domElement).target=new THREE.Vector3(0,0,0);for(var d=0;d<Se.lights.length;d++)if("pointLight"==Se.lights[d].type){var u=new THREE.PointLight(Se.lights[d].color);u.position.set(Se.lights[d].x,Se.lights[d].y,Se.lights[d].z),c.add(u)}else if("directionalLight"==Se.lights[d].type){var m=new THREE.DirectionalLight(Se.lights[d].color,Se.lights[d].intensity);m.position.set(Se.lights[d].x,Se.lights[d].y,Se.lights[d].z),c.add(m)}else if("hemisphereLight"==Se.lights[d].type){var p=new THREE.HemisphereLight(Se.lights[d].sky,Se.lights[d].ground,Se.lights[d].intensity);p.position.set(Se.lights[d].x,Se.lights[d].y,Se.lights[d].z),c.add(p)}else if("spotLight"==Se.lights[d].type){var h=new THREE.SpotLight(Se.lights[d].color,Se.lights[d].intensity,Se.lights[d].distance,Se.lights[d].angle,Se.lights[d].exponent,Se.lights[d].decay);h.position.set(Se.lights[d].x,Se.lights[d].y,Se.lights[d].z),c.add(h)}else if("ambientLight"==Se.lights[d].type){var v=new THREE.AmbientLight(Se.lights[d].color);c.add(v)}else if("areaLight"==Se.lights[d].type){var f=new THREE.AreaLight(Se.lights[d].color,Se.lights[d].intensity);c.add(f)}var g=new THREE.Clock;i()}var t,n=d;if("inPanel"==Se.inter.target){var i={};i.class="threed",i.cb=function(t){var n=document.createElement("div");n.className="container",t.appendChild(n),e(n)},i.closed=function(){kInteractive.c.removeClass(d,"running")},kInteractive.openFrame(i)}else e(n)}if("undefined"==typeof editorMode||!editorMode){for(var d=e;!this.hasClass(d,"kInteractive");){if(!d.parentNode)return;if((d=d.parentNode)==document.body)return}if(this.hasClass(d,"questions")){var u=kInteractive.readData(d);if(!u)return;var m=u.dict,p=u.userDict;if(m||(m={}),p||(p=m),u.layout&&u.layout.popup&&!this.hasClass(d,"inpopup")&&"img"==e.nodeName.toLowerCase()){var h=document.getElementById("epubContent");return h&&d.setAttribute("data-loc",function(e,t){for(var i="";e!=t;)i=n(e)+"."+i,e=e.parentNode;return""==i?"":i.substr(0,i.length-1)}(d,h)),(oe=document.createElement("iframe")).setAttribute("nwdisable","true"),oe.setAttribute("nwfaketop","true"),u.cb=function(e){function t(){if("undefined"!=typeof isKotobee){var e={};e.root=oe.contentDocument.documentElement.ownerDocument.body,e.rootIndex=d.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(e,function(){})}}var n,i=document.createElement("head");if("undefined"==typeof isKotobee){for(var a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var o=a[r];if(o.getAttribute("href").indexOf("base.css")>=0){var s=o.getAttribute("href").split("/");delete s[s.length-1],n=s.join("/");break}}if(!n)return}var c="undefined"==typeof isKotobee?n+"../xhtml/":bookPath+"EPUB/xhtml/",i="<head>";if(i+='<base href="'+kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+c+'"/>',i+='<link rel="stylesheet" type="text/css" href="../css/base.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/global.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/kotobeeInteractive.css" />',i+='<script type="text/javascript" src="../js/kotobeeInteractive.js"><\/script>',i+='<script type="text/javascript" src="../js/global.js"><\/script>',"undefined"!=typeof isKotobee){var l=clone(config);l.kotobee.email=angular.element(document.body).scope().data.user.email,i+='<script type="text/javascript">var config='+JSON.stringify(l)+";<\/script>"}i+='<meta charset="utf-8" />',i+="</head>";var u=d.outerHTML;u=(u=(u=(u=(u=(u=u.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var m="<html>"+i+"<body>"+(u+='<div class="vSpace20"></div>')+"</body></html>";oe.setAttribute("srcdoc",m);var p="javascript: window.frameElement.getAttribute('srcdoc');";oe.setAttribute("src",p),oe.contentWindow&&(oe.contentWindow.location=p),e.appendChild(oe),oe.addEventListener?oe.addEventListener("load",t,!0):oe.attachEvent&&oe.attachEvent("onload",t)},u.closed=function(){},u.pos=u.layout.pos,kInteractive.openFrame(u),kInteractive.tinCan({verb:"opened",activity:"Questions: "+u.title}),void(kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("question",u.title),e.description="Opened question popup: "+u.title,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800))}var v="Untitled questions",f=d.getElementsByTagName("h4");f.length&&(v=f[0].textContent||f[0].data);var g=0,y=d.getElementsByClassName("ques"),b=y.length,k="";if(this.hasClass(e,"kInteractive"))return;if(this.hasClass(e,"questions-clear")){for(var I=d.getElementsByClassName("ans"),C=0;C<I.length;C++)I[C].checked=!1,I[C].value=null,kInteractive.c.removeClass(I[C].parentNode,"correct");for(C=(F=d.getElementsByClassName("explanation")).length;C--;)F[C].parentNode.removeChild(F[C]);for(C=(z=d.getElementsByClassName("reference")).length;C--;)z[C].parentNode.removeChild(z[C]);return void(document[d.id]=null)}if(this.hasClass(e,"questions-notebook")){var E=u.layout&&u.layout.popup&&this.hasClass(d,"inpopup");if("undefined"==typeof isKotobee&&!E)return void kInteractive.alert({content:m.kotobeeOnly,title:p.sorry?p.sorry:"Sorry"});var w,N={elem:d};if("undefined"!=typeof isKotobee)w=angular.element(document.body).scope();else{try{w=window.parent.getGlobal()}catch(e){return void kInteractive.alert({content:m.kotobeeOnly,title:p.sorry?p.sorry:"Sorry"})}N.rootIndex=d.getAttribute("data-loc"),N.root=d}return kInteractive.c.addClass(e,"busy"),void w.questionsAddToNotebookShortcut(N,function(){kInteractive.c.removeClass(e,"busy"),kInteractive.alert({content:p.savedToNotebook?p.savedToNotebook:"Saved to notebook!"})})}if(this.hasClass(e,"questions-preserve"))return document[d.id]||(document[d.id]={}),void(document[d.id].preserve=e.checked);for(var A=0,x=0,T=[],C=0;C<y.length;C++){var L=(I=y[C].getElementsByClassName("ans")).length>0,q=u.q[C];if(u.options.randomize&&(q=u.q[Number(y[C].getAttribute("data-o"))]),kInteractive.scorm&&u.options&&u.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(d.id+"-"+(C+1),q.q))){U="<p style='text-align:center'>"+(p.alreadySubmitted?p.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:U})}var B={};T.push(B),B.id=kInteractive.getScormId(d.id+"-"+(C+1),q.q),B.qid=d.id,B.type=I[0].getAttribute("id").indexOf("ki-tf-")>=0?"true-false":"choice",B.objective=u.options?u.options.objective:null,B.timestamp=kInteractive.timestamp,B.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),B.description=q.q;for(te=0;te<I.length;te++)if(I[te].getAttribute("id").indexOf("ki-tf-")>=0)0==te&&q.a?B.correctResponses=q.choice1:1!=te||q.a||(B.correctResponses=q.choice2),I[te].checked?(B.learnerResponses=te?q.choice2:q.choice1,0!=te||q.a?1==te&&q.a&&(L=!1):L=!1):0==te&&q.a?L=!1:1!=te||q.a||(L=!1),u.options&&u.options.highlightCorrect&&(0==te&&q.a||1==te&&!q.a)&&kInteractive.c.addClass(I[te].parentNode,"correct");else if(I[te].getAttribute("id").indexOf("ki-sa-")>=0){(Z=I[te].value.toLowerCase())&&(Z=Z.trim()),L=!0;for(var H="",M=0;M<q.k.length;M++){var S=q.k[M].t;if(!S){L=!1;break}S=S.toLowerCase(),H&&(H+="+"),H+=S;for(var R=S.split(","),O=!1,D=0;D<R.length;D++)if(Z.indexOf(R[D].trim())>=0){O=!0;break}if(!O){L=!1;break}}B.correctResponses=H,B.learnerResponses=Z}else q.c[te].a&&(B.correctResponses=q.c[te].t),I[te].checked&&(B.learnerResponses=q.c[te].t),I[te].checked&&!q.c[te].a?L=!1:!I[te].checked&&q.c[te].a&&(L=!1),u.options&&u.options.highlightCorrect&&q.c[te].a&&kInteractive.c.addClass(I[te].parentNode,"correct");if(B.result=0,null!=q.weight&&(A+=q.weight,L&&(x+=q.weight,B.result=q.weight)),B.scoreMax=u.options?Number(u.options.totalScore):null,q.exp&&!y[C].getElementsByClassName("explanation").length){var F=document.createElement("p");F.className="explanation",F.innerHTML=kInteractive.escapeHtml(q.exp),kInteractive.appendAfterDelay(y[C],F)}if(q.ref&&!y[C].getElementsByClassName("reference").length){var z=document.createElement("a");z.className="reference",z.innerHTML=p.learnMode?p.learnMode:"Learn more",z.setAttribute("href",kInteractive.escapeHtml(q.ref)),z.setAttribute("target","_blank"),kInteractive.appendAfterDelay(y[C],z)}var j=p.question?p.question.replace("[no]",C+1):"Question "+(C+1);L?(k+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+j+".</span>  <span style='color:#366c20'>"+p.correct+"</span><br/>",g++):k+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+j+".</span>  <span style='color:#7a1818'>"+p.incorrect+"</span><br/>"}for(C=0;C<T.length;C++)T[C].weighting=Math.round(1e3*u.options.totalScore/A)/1e3;var P,K=u.action;if(u.options.totalScore&&A&&(P=Math.round(10*u.options.totalScore*x/A)/10),"selfAnswer"==K||"selfAnswerReport"==K){var W="";"ar"==u.options.language&&(W=' direction="rtl"');var U="";if(p.scoreWeight){if(null!=P){var _="";u.options.passScore&&(P>=u.options.passScore||P==u.options.totalScore?_+=p.pass:_+=p.fail),_&&(_+=". "),U+="<h3"+W+">"+(_||"")+p.scoreWeight.replace("[score]",P).replace("[total]",u.options.totalScore)+"</h3>"}U+="<p"+W+">"+p.score.replace("[correct]",g).replace("[total]",b)+"</p>"}else U="You scored "+g+" question(s) out of "+b;"selfAnswerReport"==K&&(U="<p"+W+"><strong>"+U+"</strong></p><p><strong>"+(p.details?p.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+k+"</p>"),kInteractive.alert({content:U}),i()}if("email"==K||u.options.reportEmail||u.options.emailForm){var V="selfAnswer"!=K&&"selfAnswerReport"!=K&&"email"!=K;try{if(!config.kotobee.cloudid)return void(V&&kInteractive.alert({content:m.cloudOnly,title:p.sorry?p.sorry:"Sorry"}))}catch(e){return void(V&&kInteractive.alert({content:m.cloudOnly,title:p.sorry?p.sorry:"Sorry"}))}var Y={};Y.ans=new Array;for(te=0;te<y.length;te++)for(var I=y[te].getElementsByClassName("ans"),C=0;C<I.length;C++)I[C].checked&&Y.ans.push({q:te,index:C,label:I[C].nextSibling.textContent||I[C].nextSibling.data});if(Y.title=v,(pe={}).recipient=u.address,u.options.reportEmail&&(pe.recipient=u.options.reportEmail),pe.content=JSON.stringify(Y),pe.mode=config.kotobee.mode,pe.cloudid=config.kotobee.cloudid,pe.email=config.kotobee.email?config.kotobee.email:angular.element(document.body).scope().data.user.email,u.options.emailForm){var Q=document.getElementsByName("recipientEmail");Q.length&&(pe.recipient=pe.recipient?pe.recipient+","+Q[0].value:Q[0].value)}var J=e.value;e.value=p.submitting?p.submitting:"Submitting ..",e.setAttribute("disabled","true");var X=new XMLHttpRequest;X.onreadystatechange=function(){try{if(4===X.readyState&&200===X.status){if(e.value=J,e.removeAttribute("disabled"),!V)return;JSON.parse(X.responseText).success?kInteractive.alert({content:p.submitted?p.submitted:"Answers submitted!"}):kInteractive.alert({content:p.errorSubmitting?p.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(t){if(e.value=J,e.setAttribute("value",e.value),e.removeAttribute("disabled"),!V)return;kInteractive.alert({content:p.errorSubmitting?p.errorSubmitting:"An error has occurred while sending answers to the server"})}};re=config.kotobee.liburl?config.kotobee.liburl:"http://www.kotobee.com/";re+="library/report/questions",X.open("POST",re),X.setRequestHeader("Content-type","application/x-www-form-urlencoded");var G="a=a";for(var $ in pe){var Z=pe[$];void 0!=Z&&("object"!=typeof Z&&("string"==typeof Z&&(Z=encodeURIComponent(Z)),"boolean"==typeof Z&&(Z=Z?1:0),G+="&"+$+"="+Z))}X.send(G),i()}document[d.id]||(document[d.id]={}),document[d.id].q=[];for(var ee=d.getElementsByClassName("ques"),te=0;te<ee.length;te++){var ne=te;u.options.randomize&&(ne=Number(ee[te].getAttribute("data-o"))),document[d.id].q[ne]=[];for(var ie=ee[te].getElementsByClassName("ans"),C=0;C<ie.length;C++)kInteractive.hasClass(ie[C],"txtfield")?document[d.id].q[ne][C]=ie[C].value:document[d.id].q[ne][C]=ie[C].checked}kInteractive.scorm&&setTimeout(function(){kInteractive.scorm.setInteractions(T)},500)}else if(this.hasClass(d,"widget")){var ae=kInteractive.readData(d);if(!ae)return;var re=kInteractive.getWidgetUrl(ae),oe=document.createElement("iframe");oe.setAttribute("nwdisable","true"),oe.setAttribute("nwfaketop","true"),ae.cb=function(e){oe.src=re,e.appendChild(oe)},ae.cb1="yes",ae.closed=function(){},kInteractive.openFrame(ae),kInteractive.tinCan({verb:"opened",activity:"Widget: "+ae.name}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("widget",ae.name),e.description="Opened popup widget: "+ae.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else{if(this.hasClass(e,"link")){if(!(pe=kInteractive.readData(e)))return;if("popup"==pe.type){if(U=(U="<div class='kbAlertScroll'>"+pe.msg+"</div>").replace(/src="(.*?)"/g,function(){var e=arguments[1];return"undefined"!=typeof isKotobee&&(e=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e)),'src="'+e+'"'}),"image"==pe.popupMode){var se=pe.popupImg;"undefined"!=typeof isKotobee&&(se=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,se)),U="<img src='"+se+"'/>"}kInteractive.alert({content:U}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("popup",pe.msg),e.description="Shown popup message: "+pe.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else if("audio"==pe.type){kInteractive.stopCurrentMedia();var ce=document.createElement("audio"),le=pe.src;"file"==pe.audioType&&(le="undefined"==typeof isKotobee?pe.audio:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,pe.audio)),ce.setAttribute("src",le);var de,ue=document.createElement("div");ue.className="kiAudioLoader",ue.style.transform=ue.style.webkitTransform=ue.style.mozTransform="scale(1)";var me=document.createElement("div");me.className="kiAudioSpinner",ue.appendChild(me),e.parentNode.insertBefore(ue,e),ce.onplaying=a,setTimeout(a,5e3),ce.play(),kInteractive.currentAudio=ce,kInteractive.tinCan({verb:"played",activity:"Audio: "+le}),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(e.textContent,le),B.description="Played audio link: "+le,B.type="other",B.learnerResponses="Played",B.objective=pe.options?pe.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B]))}return!1}if(this.hasClass(e,"image")){if(e.parentNode&&this.hasClass(e.parentNode,"kInteractive")&&this.hasClass(e.parentNode,"link"))return void this.action(e.parentNode,t);var pe=kInteractive.readData(e);if(!pe)return;var he=pe.behavior;if("none"==he)return;r(e,"none"),o(e,"none"),s(e,"none"),setTimeout(function(){function t(i){r(e,"none"),o(e,"none"),s(e,"none"),e.removeEventListener(n,t)}"wiggle"==he?(r(e,"wiggle"),o(e,"0.5s"),s(e,"1")):"jump"==he?(r(e,"jump"),o(e,"0.7s"),s(e,"1")):"scale"==he&&(r(e,"scale"),o(e,"0.5s"),s(e,"1"));var n=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();n&&e.addEventListener(n,t)}),kInteractive.tinCan({verb:"clicked",activity:he+"image: "+e.getAttribute("src")})}else if(this.hasClass(d,"gallery")){var ve=d.getElementsByClassName("images")[0],g=ve.children.length,fe=d.getElementsByClassName("selected")[0],ge=Number(fe.style.left.slice(0,-2)),ye=Number(ve.style.left.slice(0,-2));if(this.hasClass(e,"next")){var be=fe.nextSibling;if(!be)return;kInteractive.c.removeClass(fe,"selected"),kInteractive.c.addClass(be,"selected"),be.style.left=ge+ve.offsetWidth+"px",be.style.display="block",ve.style.left=ye-ve.offsetWidth+"px",be.nextSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(d.getElementsByClassName("prev")[0],"disable"),fe=be}else if(this.hasClass(e,"prev")){var ke=fe.previousSibling;if(!ke)return;kInteractive.c.removeClass(fe,"selected"),kInteractive.c.addClass(ke,"selected"),ke.style.left=ge-ve.offsetWidth+"px",ke.style.display="block",ve.style.left=ye+ve.offsetWidth+"px",ke.previousSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(d.getElementsByClassName("next")[0],"disable"),fe=ke}var Ie=d.getElementsByClassName("imgCaption");if(!Ie.length)return;var Ce=(Ie=Ie[0]).getElementsByClassName("inner");if(!Ce.length)return;(Ce=Ce[0]).style.display="none",fe.hasAttribute("data-caption")&&(Ce.innerHTML=fe.getAttribute("data-caption"),Ce.style.display=null)}else if(this.hasClass(d,"audio")){kInteractive.stopCurrentMedia();var Ee=kInteractive.readData(d);if(!Ee)return;Ee.audioType||(Ee.audioType=Ee.type);xe=d.getAttribute("id")+"-container";(Te=d.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn hide";le=Ee.src;"file"==Ee.audioType&&(le="undefined"==typeof isKotobee?Ee.audio:Ee.relToRoot?ph.join(bookPath,Ee.audio):ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,Ee.audio)),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(d.getAttribute("id"),le),B.description="Played audio: "+le,B.type="other",B.learnerResponses="Played",B.objective=Ee.options?Ee.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B]));var we=document.createElement("audio");we.setAttribute("controls","true"),we.setAttribute("autoplay","true"),we.setAttribute("data-tap-disabled","false");var Ne=document.createElement("source");Ne.src=le,we.appendChild(Ne),we.appendChild(document.createTextNode("Your browser does not support the audio element")),we.className="ki-noHighlight",we.oncanplay=function(){kInteractive.currentAudio==d&&kInteractive.tinCan({verb:"played",activity:"Audio: "+le})},d.getElementsByClassName("container")[0].appendChild(we),we.play(),kInteractive.currentAudio=d,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}else if(this.hasClass(d,"video")){var Ae=kInteractive.readData(d);if(!Ae)return;var xe=d.getAttribute("id")+"-container",Te=d.getElementsByClassName("playBtn")[0];if(Te.className.indexOf("loading")>=0)return;if(kInteractive.stopCurrentMedia(),Te.className="playBtn ki-btn loading",Ae.autoplay&&(Te.className="playBtn ki-btn hide"),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(d.getAttribute("id"),Ae.src),B.description="Played video: "+Ae.src,B.type="other",B.learnerResponses="Played",B.objective=Ae.options?Ae.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B])),"file"==Ae.type)c(le="undefined"==typeof isKotobee?Ae.video:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,Ae.video));else if(Ae.src.indexOf("youtube.com")>=0||Ae.src.indexOf("youtu.be/")>=0){var Le;if(Ae.src.indexOf("youtube.com")>=0)Le=(qe=Ae.src.split("watch?v="))[1];else{if(!(Ae.src.indexOf("youtu.be/")>=0))return;var qe=Ae.src.split("youtu.be/");Le=qe[qe.length-1]}if(window&&window.iBooks)return setTimeout(function(){Te.className="playBtn ki-btn"},1500),void(window.location.href=Ae.src);var Be={videoId:Le,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+Ae.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){Te.className="playBtn ki-btn hide",new YT.Player(xe,Be)}}else"ready"==kInteractive.youTubeStatus&&(Te.className="playBtn ki-btn hide",new YT.Player(xe,Be));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var He=document.createElement("script");He.src="https://www.youtube.com/player_api";var Me=document.getElementsByTagName("script")[0];Me.parentNode.insertBefore(He,Me),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){Te.className="playBtn ki-btn hide",new YT.Player(xe,Be)}}}else c(Ae.src);kInteractive.currentVideo=d,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}else if(this.hasClass(d,"threed")){var Se=kInteractive.readData(d);if(!Se)return;"inPanel"==Se.inter.target?kInteractive.c.addClass(d,"running"):d.innerHTML="";var Re=document.createElement("div");if(Re.className="loading",d.appendChild(Re),"undefined"==typeof THREE){var Oe,De=document.getElementsByTagName("head")[0],Fe=De.getElementsByTagName("script");if("undefined"!=typeof isKotobee)Oe=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(te=0;te<Fe.length;te++)if(Fe[te].src.indexOf("kotobeeinteractive.js")>=0){Oe=Fe[te].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!Oe)return;var ze=document.createElement("script");ze.type="text/javascript",ze.src=Oe,ze.onload=l,ze.onreadystatechange=function(){"complete"==this.readyState&&l()},De.appendChild(ze)}else l()}}}},openFrame:function(e){function t(){i.style.display="block",i.className="show";var t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;t-=20,r-=20;var o=1;if(e.width&&e.height){var s=r/e.width,l=t/e.height;(o=s<l?s:l)>1&&(o=1)}var d="display:block;";d+=a;var u=e.width||e.height?"-50%,-50%":"0%,0%";d+="-webkit-transform:translate("+u+") scale("+o+");-moz-transform:translate("+u+") scale("+o+");transform:translate("+u+") scale("+o+");",d+="position:fixed;","undefined"==typeof isKotobee&&(d+="top:"+Math.round(window.innerHeight/2)+"px;",d+="left:"+Math.round(window.innerWidth/2)+"px;"),n.style.cssText=d,n.className=c+" ready";var m=n.getElementsByClassName("closeBtn");if(m.length){var p=m[0],h=1/o,v="-50%";kInteractive.hasClass(p,"side")&&(v="0%"),p.style.cssText="-webkit-transform: translate("+v+",0%) scale("+h+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+v+",0%) scale("+h+");-moz-transform-origin: 50% 50%;transform: translate("+v+",0%) scale("+h+");transform-origin: 50% 50%;"}}var n=document.getElementById("kInteractiveFrame"),i=document.getElementById("kiDarkOverlay"),a="";if(e.dict||(e.dict={}),e.width&&(a+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(a+="height:"+e.height+"px;max-height:"+e.height+"px;"),n||((i=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(i),i.style.display="none",i.style.position="fixed",i.addEventListener("click",kInteractive.closeFrame),(n=document.createElement("div")).id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var r=document.createElement("a"),o="closeBtn";e.pos&&(o+=" "+e.pos),r.className=o;var s=e.dict.close?e.dict.close:"Close";try{s=angular.element(document.body).scope().translit("close")}catch(e){}"side"!=e.pos&&(r.innerHTML=s),r.addEventListener("click",kInteractive.closeFrame),n.appendChild(r)}var c=e.class?e.class:"";(e.width||e.height)&&(c+=" fixed"),n.style.display="block",n.className=c,document.body.appendChild(n),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e,kInteractive.openFrame.resized=t,window.addEventListener("resize",t),setTimeout(function(){t(),e.cb&&e.cb(n)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t.parentNode.removeChild(t),n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1,window.removeEventListener("resize",kInteractive.alert.resized),kInteractive.alert.resized=null},closeFrame:function(){var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,i="";n.width&&(i+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(i+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=i,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300)},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";(t=document.getElementById(e))&&(t.parentNode.removeChild(t),(n=document.createElement("div")).setAttribute("id",e),n.className="container",(i=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),kInteractive.currentVideo.appendChild(n))}if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id")){e+="-container";var t=document.getElementById(e);if(t){t.parentNode.removeChild(t);var n=document.createElement("div");n.setAttribute("id",e),n.className="container";var i=kInteractive.currentAudio.getElementsByClassName("playBtn")[0];i.className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),kInteractive.currentAudio.appendChild(n)}}else try{var a=kInteractive.currentAudio.getElementsByTagName("audio");a.length&&(a[0].pause(),a[0].src=""),kInteractive.currentAudio.pause&&(kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="");for(var r=document.getElementsByClassName("kiAudioLoader"),o=r.length;o--;)r[o].parentNode.removeChild(r[o])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),i=0;i<n.length;i++)if(n[i]&&n[i].trim()==t)return!0},appendAfterDelay:function(e,t){setTimeout(function(){e.appendChild(t)},30)},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,i=n.cloneNode(!1);return i.innerHTML=t,n.parentNode.replaceChild(i,n),i},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var i,a=document.implementation.createHTMLDocument(""),r=a.documentElement;return r.innerHTML=e,i=r.firstElementChild,1===r.childElementCount&&"html"===i.localName.toLowerCase()&&a.replaceChild(i,r),a}return n.apply(this,arguments)}}(DOMParser)},readData:function(e){try{var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),JSON.parse(decodeURI(kInteractive.XORCipher().decode("kotobee%%author",t)))}catch(e){try{return JSON.parse(kInteractive.XORCipher().decode("kotobee%%author",t))}catch(e){}}},writeData:function(e,t){var n=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher().encode("kotobee%%author",n))},XORCipher:function(){function e(e){var t,n,i,a,r,s,c=0,l="";if(!e)return e;do{t=(r=e[c++]<<16|e[c++]<<8|e[c++])>>18&63,n=r>>12&63,i=r>>6&63,a=63&r,l+=o.charAt(t)+o.charAt(n)+o.charAt(i)+o.charAt(a)}while(c<e.length);return((s=e.length%3)?l.slice(0,s-3):l)+"===".slice(s||3)}function t(e){var t,n,i,a,r,s,c=0,l=[];if(!e)return e;e+="";do{t=(s=o.indexOf(e.charAt(c++))<<18|o.indexOf(e.charAt(c++))<<12|(a=o.indexOf(e.charAt(c++)))<<6|(r=o.indexOf(e.charAt(c++))))>>16&255,n=s>>8&255,i=255&s,l.push(t),64!==a&&(l.push(n),64!==r&&l.push(i))}while(c<e.length);return l}function n(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){return r(t,function(t,i){return t.charCodeAt(0)^n(e,i)})}function a(e,t){return r(t,function(t,i){return String.fromCharCode(t^n(e,i))}).join("")}function r(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t,n){return n=i(t,n),e(n)},decode:function(e,n){return n=t(n),a(e,n)}}},getScormId:function(e,t){return t&&(t=t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80)),e+"-"+t},alert:function(e){function t(){"undefined"==typeof isKotobee&&(n.style.top=Math.round(window.innerHeight/2)+"px",n.style.left=Math.round(window.innerWidth/2)+"px")}var n=document.createElement("div");n.setAttribute("id","kiSystemAlertBox"),n.style.position="fixed","undefined"==typeof isKotobee&&(n.style.top=Math.round(window.innerHeight/2)+"px",n.style.left=Math.round(window.innerWidth/2)+"px");var i=document.createElement("div");i.innerHTML=e.content.replace("&nbsp;","&#160;"),i.className="content",n.appendChild(i);var a=document.createElement("div");if(a.className="footer",e.title){var r=document.createElement("div");r.innerHTML=e.title.replace("&nbsp;","&#160;"),r.className="header",n.insertBefore(r,n.firstChild)}var o=document.createElement("a"),s="OK";try{s=angular.element(document.body).scope().translit("ok")}catch(e){}o.innerHTML=s.replace("&nbsp;","&#160;"),o.className="okBtn",kInteractive.alertIsOpen=!0,o.addEventListener("click",kInteractive.closeAlert),a.appendChild(o),n.appendChild(a);var c=document.createElement("div");c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),c.style.position="fixed",document.body.appendChild(c),document.body.appendChild(n),o.focus(),kInteractive.alert.resized=t,window.addEventListener("resize",t),setTimeout(function(){n.className="show",c.className="show"},50)},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)-1==n.indexOf(t[a])&&(i=!1,n+=(""==n?"":" ")+t[a]);if(i)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)n.indexOf(t[a])>=0&&(i=!1,n=n.replace(t[a],""));if(i)return}else{if(-1==n.indexOf(t))return;n=n.replace(t,"")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);return-1==t[t.length-1].indexOf(".")?e:(t.splice(t.length-1,1),t.join("/"))},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},resizeEvent:function(e,t){function n(e,t){if(e&&e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}}var i,a=e||document;t&&(a=document);for(var r=(i=a.getElementsByClassName("kInteractive")).length;r--;){var o=i[r];if(this.hasClass(o,"image")){var s=kInteractive.readData(o);if(!s)return;n(s,o)}else if(this.hasClass(o,"gallery")){var c=kInteractive.readData(o);if(!c)return;n(c,o)}else if(this.hasClass(o,"container")){var l=kInteractive.readData(o);if(!l)return;n(l,o)}else if(this.hasClass(o,"video")){var d=kInteractive.readData(o);if(!d)return;if(n(d,o),!d.maintainRatio)continue;if("px"!=d.widthUnit)continue;if(!d.height||!d.width)continue;o.style.height=o.offsetWidth*(d.height/d.width)+"px"}else if(this.hasClass(o,"widget")){var u=kInteractive.readData(o);if(!u)return;if("page"!=u.mode)continue;if("px"!=u.widthUnit)continue;var m=u.width,p=u.height,h=o.parentNode;if(!h)continue;if(m>h.offsetWidth){var v=h.offsetWidth/m,f=o.children.length-1;o.children[f].style.transform=o.children[f].style.webkitTransform=o.children[f].style.mozTransform="scale("+v+")",o.children[f].style.transformOrigin=o.children[f].style.webkitTransformOrigin=o.children[f].style.mozTransformOrigin="0 0",o.style.maxWidth=o.style.width,o.style.height=Math.round(p*v)+"px"}else{for(f=0;f<o.children.length;f++)o.children[f].style.transform=o.children[f].style.webkitTransform=o.children[f].style.mozTransform=o.children[f].style.transformOrigin=o.children[f].style.webkitTransformOrigin=o.children[f].style.mozTransformOrigin=null;o.style.maxWidth=null,o.style.height=p+"px"}}}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},getWidgetHome:function(e){return e.path?"undefined"==typeof isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"},getWidgetUrl:function(e){var t=kInteractive.getWidgetHome(e)+"/"+e.name+"/"+e.src;if("undefined"!=typeof isKotobee){var n=angular.element(document.body).scope().data.user;n&&n.email&&n.signatures&&n.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(t+="?oauth_signature="+n.signatures.bookwidgets.signature,t+="&oauth_nonce="+n.signatures.bookwidgets.nonce,t+="&oauth_timestamp="+n.signatures.bookwidgets.timestamp,t+="&oauth_consumer_key="+n.signatures.bookwidgets.key,t+="&lti_version=LTI-1p0",t+="&oauth_signature_method=HMAC-SHA1",t+="&oauth_version=1.0",t+="&tool_consumer_info_product_family_code=kotobee",t+="&lis_person_contact_email_primary="+n.email,t+="&lis_person_name_full="+(n.name?n.name:""),t+="&user_id="+n.id,t+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures())}return t},vQueue:[],youTubeReady:!1,firstRun:!0};if("undefined"==typeof isKotobee)try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}