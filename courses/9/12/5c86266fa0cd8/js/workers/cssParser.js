function parse(e){function r(e){if(e){for(var r=e.split(";"),t="",n=0;n<r.length;n++)r[n]&&-1!=r[n].trim().indexOf("background")&&(t=r[n].trim().replace(/url\(.*?\)/g,"")+";");return t}}function t(e){for(var r={},t=0;t<e.length;t++)if(e[t]){var n=e[t].trim();0!=n.indexOf("body")?0!=n.indexOf("html")?0!=n.indexOf("@media")&&0!=n.indexOf("@")&&isNaN(n[0])&&"from"!=n&&"to"!=n&&(e[t]=p+" "+n):e[t]=n.replace("html",p):(e[t]=n.replace("body",p),0==e[t].indexOf("html")&&(e[t]=e[t].replace("html",p)),r.hasBody=!0)}return r.joined=e.join(","),r}var n=self;e||(e={});e.html;var i=e.data,s=e.rootPath,a=e.cssOb;i=(i=(i=(i=(i=n.applyRoot(s,i)).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/<!--/g,"")).replace(/-->/g,"")).replace(/@charset.*?;/g,"");var l="spreadL > section";e.id&&(l=e.id);var p=(a.parentClass?a.parentClass:"#epubContainer.stylesEnabled")+" #"+l,o=cssToJson(i),h="";try{for(var d=0;d<o.length;d++){var c=t(o[d].keys);if(h+=c.joined,h+="{",o[d].children&&o[d].children.length)for(var f=0;f<o[d].children.length;f++){var u=t(o[d].children[f].keys);h+=u.joined,h+="{"+o[d].children[f].properties+"}",u.hasBody&&(g=r(o[d].properties))&&(h+="#epubContainer{"+g+"}")}if(o[d].properties&&(h+=o[d].properties),h+="}",c.hasBody){var g=r(o[d].properties);g&&(h+="#epubContainer{"+g+"}")}}}catch(e){}i=minimizeData(i=h),self.postMessage({data:i,id:id})}function minimizeData(e){var r=e;return r=r.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,""),r=r.replace(/ {2,}/g," "),r=r.replace(/ ([{:}]) /g,"$1"),r=r.replace(/([;,]) /g,"$1"),r=r.replace(/ !/g,"!")}function cssToJson(e){function r(e){return e||(e=1),s[s.length-e]}e=e.replace(/\r?\n|\r/g," ");for(var t,n=[],i="key",s=[0],a=n,l=[a],p=0;p<e.length;p++)t||(t={}),"}"==e[p]?("properties"==i&&(t.properties=e.substring(r(),p).trim(),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),a.push(t)),"key"==i&&l.length>1&&(l.pop(),a=l[l.length-1]),t=null,i="key",s.push(p+1)):"{"==e[p]?("properties"==i&&(t.children||(t.children=[]),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),n.push(t),a=t.children,l.push(a),(t={keys:[]}).keys.push(e.substring(r(),p).trim())),s.push(p+1),i="properties"):"key"==i&&(t.keys||(t.keys=[""]),","==e[p]?t.keys.push(""):t.keys[t.keys.length-1]+=e[p]);return n}function applyRoot(e,r){var t=/url\((.*?)\)/g;return r.replace(t,function(r,t){var n="";return 0==t.indexOf('"')?(t=t.substr(1,t.length-2),n='"'):0==t.indexOf("'")&&(t=t.substr(1,t.length-2),n="'"),-1!=t.indexOf("http://")?arguments[0]:-1!=t.indexOf("https://")?arguments[0]:0==t.indexOf("data:")?arguments[0]:(t=ph.join(e,t),"url("+n+t+n+")")})}function isAbsoluteURLPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||void 0)))}var id,desktop,self=this;self.addEventListener("message",function(e){var r=e.data.func,t=e.data.params;id=e.data.id,desktop=e.data.desktop,self[r].apply(self,t)},!1);var ph={};ph.join=function(){for(var e=new Array,r=0;r<arguments.length;r++){var t=ph.normalizedArray(arguments[r]);r<arguments.length-1&&!isAbsoluteURLPath(t[t.length-1])&&t[t.length-1].indexOf(".")>=0&&t.splice(t.length-1,1),e=e.concat(t)}var n=ph.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(n=desktop?"file:////"+n:"/"+n),n},ph.normalize=function(e){var r=ph.normalizedArray(e).join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(r="file:///"+r),r},ph.normalizedArray=function(e){for(var r=(e=e.replace(/\\/g,"/")).split("/"),t=r.length;t--;)r[t]?".."==r[t]&&t>0&&".."!=r[t-1]&&(r.splice(t,1),r.splice(t-1,1)):r.splice(t,1);return r[0].match(/http[s]?:$/g)&&(r[0]+="//"+r[1],r.splice(1,1)),"file:"==r[0]&&(r[0]+="///"+r[1],r.splice(1,1)),r};var log=console.log;