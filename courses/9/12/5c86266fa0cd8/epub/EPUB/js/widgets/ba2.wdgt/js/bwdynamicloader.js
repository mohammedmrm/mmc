function BwLoadJsFile(e,o,n,i){var t=$.Deferred(),a=document.createElement("script");if(a.setAttribute("type","text/javascript"),n)for(var s in n)n.hasOwnProperty(s)&&a.setAttribute(s,n[s]);var d;return a.setAttribute("src",e),a.onload=function(){d&&clearTimeout(d),t.resolve()},a.onerror=function(){d&&clearTimeout(d),t.reject()},i&&(d=window.setTimeout(function(){console.error("Timeout loading "+e),t.reject()},i)),null!=a&&document.getElementsByTagName(o)[0].appendChild(a),t}function BwLoadCssFile(e,o){var n=$.Deferred(),i=document.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e),i.onload=function(){n.resolve()},i.onerror=function(){n.reject()},"undefined"!=typeof i&&document.getElementsByTagName(o)[0].appendChild(i),n}function BwLoadFile(e,o,n){function i(e,o){position=e.length-o.length;var n=e.indexOf(o,position);return n!==-1&&n===position}return i(e,".css")?BwLoadCssFile(e,o):BwLoadJsFile(e,o)}function BwUseManualWidgetLoadedNotification(){BwAutomaticWidgetLoadedNotification=!1}function BwNotifyWidgetLoaded(){BwWidgetLoadedNotified||(BwWidgetLoadedNotified=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())}function BwExecutePostLoadCallbacks(){for(;BwPostLoadCallbacks.length>0;){var e=BwPostLoadCallbacks.shift();e()}BwAutomaticWidgetLoadedNotification&&BwNotifyWidgetLoaded()}function BwLoadNext(){if(BwModules.length>0){var e=BwModules.shift();e.indexOf(".js")!=-1?BwLoadJsFile(e,"head").done(BwLoadNext).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load js file '"+e+"'")),BwLoadNext()}):e.indexOf(".css")!=-1?BwLoadCssFile(e,"head").done(BwLoadNext).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load css file '"+e+"'")),BwLoadNext()}):("undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load file of unknown type '"+e+"'")),console.error("Unknown file type, can't load: "+e),BwLoadNext())}else BwLoadingDone=!0,setTimeout(BwExecutePostLoadCallbacks,0)}function BwAddPostLoadCallback(e){BwLoadingDone?setTimeout(e,0):BwPostLoadCallbacks.push(e)}function BwGetUrlParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=o.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function isJsFile(e){function o(e,o){position=e.length-o.length;var n=e.indexOf(o,position);return n!==-1&&n===position}return o(e.split("?")[0].split("#")[0],".js")}function fixConfigFileLocation(e){""!==BwConfigJs&&(BwConfigJs=e+BwConfigJs),""!==BwConfigCss&&(BwConfigCss=e+BwConfigCss),""!==BwTranslation&&(BwTranslation=e+BwTranslation)}function BwConfigLoaded(){for(var e=0;e<window.BwSettings.length;++e){var o=window.BwSettings[e];config[o]=BwSettingsTemp[o]}BwLoadNext()}function addDesignInfo(e,o){var n=$(e);console.log("addDesignInfo: "+e+" - "+o+" "+n.length),n.attr("data-tipsy",o);var i="n";n.height()>700?i=n.offset()&&n.offset().left>800?"e":"w":n.offset()&&n.offset().top>700&&(i="s"),tipsy_selectors.push([e,i,o])}function activateDesignInfoTooltips(){var e=!0;$.each(tipsy_selectors,function(o,n){$(n[0]).tipsy({html:!0,title:"data-tipsy",gravity:n[1]}),$(n[0]).click(function(o){"undefined"!=typeof previewsidebar&&e&&(previewsidebar.setSelectedItem(n[2]),e=!1,setTimeout(function(){e=!0},100))})})}function postConfigJsLoad(){bwdefine("baseconfig",[],function(){return widgetconfig})}function BwTranslationLoaded(){window.hasOwnProperty("BwSettings")||(window.BwSettings=["LocalizationMap"]);for(var e=0;e<window.BwSettings.length;++e){var o=window.BwSettings[e];BwSettingsTemp[o]=config[o]}BwLoadJsFile(BwConfigJs,"head").done(function(){postConfigJsLoad(),BwConfigLoaded()}).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load js file '"+BwConfigJs+"'")),BwConfigLoaded()})}function BwLoadTranslationAndConfig(){""==BwTranslation?BwLoadJsFile(BwConfigJs,"head").done(function(){postConfigJsLoad(),BwLoadNext()}).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load js file '"+BwConfigJs+"'")),BwLoadNext()}):BwLoadJsFile(BwTranslation,"head").done(BwTranslationLoaded).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load js file '"+BwTranslation+"'")),BwTranslationLoaded()})}function BwLoadConfigCss(){"none"!=BwConfigCss?BwLoadCssFile(BwConfigCss,"head").done(BwLoadTranslationAndConfig).fail(function(){"undefined"!=typeof Bugsnag&&Bugsnag.notify(new Error("Load error: Could not load css file '"+BwConfigCss+"'")),BwLoadTranslationAndConfig()}):BwLoadTranslationAndConfig()}function BwLoadDebug(){""!=BwDebug?BwLoadJsFile("//d2wy8f7a9ursnm.cloudfront.net/v4/bugsnag.min.js","head",null,1e3).done(function(){window.Bugsnag=window.bugsnag(BwDebug)}).always(BwLoadConfigCss):BwLoadConfigCss()}function bwdefine(e,o,n){bwdefine_data.bwDefine(e,o,n)}BwModules=["js/utils.js"];var BwPostLoadCallbacks=[],BwLoadingDone=!1;window.parent.postMessage("BwWidgetLoading","*"),BwAutomaticWidgetLoadedNotification=!0;var BwWidgetLoadedNotified=!1,BwDebug=BwGetUrlParameter("dbg4"),BwTranslation=BwGetUrlParameter("translation");""===BwTranslation||isJsFile(BwTranslation)||(console.error("Wrong translation filename, ignoring"),BwConfigJs="");var BwConfigJs=BwGetUrlParameter("content");""===BwConfigJs||isJsFile(BwConfigJs)||(console.error("Wrong content filename, ignoring"),BwConfigJs="");var BwConfigCss=BwGetUrlParameter("design"),BwSettingsTemp={};0==window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?fixConfigFileLocation(window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"):"widgets-eu.bookwidgets.com"===window.location.host&&fixConfigFileLocation("//widget-assets-eu.bookwidgets.com"),""==BwConfigJs?BwConfigJs="config.js":BwConfigJs.indexOf(".js")==-1&&(BwConfigJs+=".js"),""==BwConfigCss?BwConfigCss="config.css":BwConfigCss.indexOf(".css")==-1&&(BwConfigCss+=".css"),""!=BwTranslation&&BwTranslation.indexOf(".js")==-1&&(BwTranslation+=".js");var tipsy_selectors=[],OptionalModuleEntryPoints={bwaudio:"js/bwaudio.js",NoAudio:"js/bwnoaudio.js",scientific:"js/scientificcalculator_init.js",MathJs:"js/math.min.js",MathJax24:"js/bwmath.js",NoMath:"js/bwnomath.js",bwwysiwyg:"js/bwwysiwyg.js",nobwwysiwyg:"js/nobwwysiwyg.js"};BwLoadDebug();var bwdefine_data={modules:{},loading_modules:{},loaded_modules:{},loadModuleFile:function(e,o){if(this.modules.hasOwnProperty(e)!==!0&&this.loading_modules.hasOwnProperty(e)!==!0&&this.loaded_modules.hasOwnProperty(e)!==!0){this.loading_modules[e]=!0;var n=this;BwLoadFile(o,"head").done(function(){e==o&&n.moduleLoaded(e)}).fail(function(){console.error("module "+e+" dynamic load error")})}},checkLoadedModules:function(){for(name in this.loaded_modules)this.checkWaitingModule(name)},moduleLoaded:function(e,o){this.modules[e]=o,delete this.loaded_modules[e],this.checkLoadedModules()},checkWaitingModule:function(e){for(var o=this.loaded_modules[e],n=o.dependencies,i=[],t=!0,a=0;a<n.length;++a){var s,d,r=n[a];r.constructor===Array?(s=r[0],d=r[1]):(s=r,d=null),this.modules.hasOwnProperty(s)===!1?(null!=d&&this.loadModuleFile(s,d),t=!1):i.push(this.modules[s])}if(!t)return!1;var l=this;$.when(o.callback.apply(null,i)).always(function(o){l.moduleLoaded(e,o)})},bwDefine:function(e,o,n){if(!this.modules.hasOwnProperty(e)&&!this.loaded_modules.hasOwnProperty(e)){var i={dependencies:o,callback:n};this.loading_modules.hasOwnProperty(e)&&delete this.loading_modules[e],this.loaded_modules[e]=i,this.checkWaitingModule(e)}}};bwdefine_data.loading_modules.config=!0,bwdefine.finalize=function(){"use strict";window.setTimeout(function(){for(var e in bwdefine_data.loaded_modules){if(!bwdefine_data.loaded_modules.hasOwnProperty(e))return;for(var o=bwdefine_data.loaded_modules[e],n=[],i=0;i<o.dependencies.length;++i){var t=o.dependencies[i],a=t.constructor===Array?t[0]:t;bwdefine_data.modules.hasOwnProperty(a)===!1&&n.push(a)}var s="Module pending: "+e+". Missing dependencies: "+n.join(",");console.error(s)}},5e3)},bwdefine("generalInit",["config"],function(e){if("modules"in e)for(var o=0;o<e.modules.length;++o)e.modules[o]in OptionalModuleEntryPoints&&BwModules.splice(o,0,OptionalModuleEntryPoints[e.modules[o]]);return"bwshortcode"in e&&(window.bwshortcode=e.bwshortcode),"pre"in e&&"designinfo"in e&&"undefined"!=typeof previewsidebar&&$(function(){BwAddPostLoadCallback(function(){CssUpdateCounter&&updateConfigCSS(CssUpdateCounter),console.log("Activating tooltips"),setTimeout(function(){for(var o=0;o<e.designinfo.length;++o)addDesignInfo(e.designinfo[o].s,e.designinfo[o].d);activateDesignInfoTooltips()},3e3)})}),"bra"in e&&$(function(){"iPad"==navigator.platform&&navigator.userAgent.indexOf("BookWidgets")!=-1||$("body").append('<div class="branding"></img></div>')}),"tri"in e&&$(function(){if("iPad"==navigator.platform||navigator.userAgent.indexOf("BookWidgets")==-1&&navigator.userAgent.indexOf("ibookwidgets")==-1){$("body").append('<div class="dialog-sheet" id="preview_alert" style="color: red; text-shadow: none;">"  <p>This is a free preview widget, created using a trial version of BookWidgets. <b>This widget may only be used for demonstration and evaluation purposes!</b></p>  <p>Please purchase a license key for the BookWidgets tool to remove this message.</p></div>');var e=$('<div class="dialog-sheet-shadow"/>');$(document.body).append(e),CreateDialogSheetFor("#preview_alert"),setTimeout(function(){$("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){$("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){$("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){$("#preview_alert").data("dialogSheet").hide()},34e3)}}),null});