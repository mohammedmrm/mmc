bwdefine("bwtable",["jquery"],function(e){e.fn.extend({bwtable:function(t,n){function a(t,n){var a=t.data("config"),r=t.find("tr");t.toggleClass("readonly",a.readOnly===!0);for(var d=0;d<r.length;++d)for(var o=e(r[d]),l=a.data[d],i=(e(r[d]),o.find("td")),c=0;c<i.length;++c){var u=l[c],f=e(i[c]);if(n||u!==f.attr("value")){var s=a.cells(d,c),p=e(document.createElement("div")).addClass("bw-table-cell-contents").html(u);f.find(".bw-table-cell-contents").replaceWith(p),s.hasOwnProperty("renderer")&&s.renderer(t,f[0],d,c,null,u,s),f.attr("value",u),f.find("input").val(u)}}}function r(e,t){var n=e.data("config");n.data=t}function d(e,t){var n=e.data("config");for(var a in t)n[a]=t[a]}function o(e,t,n){return"render"===t?void a(e,!0):"loaddata"===t?(r(e,n),void a(e,!1)):"updateSettings"===t?(d(e,n),void a(e,!0)):void console.error("Unknown bwtable command: ",t)}function l(t,n){function r(t,n){return function(){var t=e(this);t.parent().addClass("editing")}}function d(n,r){return function(){var d=e(this),o=d.parent().parent().parent().parent().parent().data("config");d.parent().removeClass("editing");var l=d.val();d.parent().attr("value")!==l&&(o.data[n][r]=l,o.onChange([[n,r]]),a(t))}}t.empty();for(var o=e(document.createElement("table")).addClass("bw-table"),l=e(document.createElement("tbody")).appendTo(o),i=0;i<n.data.length;++i)for(var c=n.data[i],u=e(document.createElement("tr")).appendTo(l),f=0;f<c.length;++f){var s=c[f],p=e(document.createElement("td")).attr("value",s).appendTo(u);n.hasOwnProperty("colWidths")&&p.css({width:n.colWidths[f]});var v=n.cells(i,f);e(document.createElement("div")).addClass("bw-table-cell-contents").html(s).appendTo(p);if(v.hasOwnProperty("renderer")&&v.renderer(t,p[0],i,f,null,s,v),v.readOnly!==!0){e(document.createElement("input")).addClass("bw-table-cell-input").val(s).appendTo(p).on("focus",r(i,f)).on("blur",d(i,f)).on("keyup",function(t){var n="undefined"!=typeof t?t:event,a=n.keyCode;13===a&&e(this).trigger("blur")})}}o.appendTo(t),t.data("config",n)}return"string"==typeof t?void o(this,t,n):void("object"==typeof t&&l(this,t))}})});