function BWIgnoreEvent(t){t.preventDefault(),t.stopPropagation()}function bwstep(t){for(var e=0;e<bwanimations.length;++e){var n=bwanimations[e];0==n.starttime&&(n.starttime=t);var i=t-n.starttime;if(i>=n.duration){n.obj.setTranslate(n.to_x,n.to_y);var n=bwanimations.splice(e,1);--e,null!=n[0].callback&&n[0].callback()}else{var o=i/n.duration,r=n.easingfunc(o,i,0,1,n.duration);n.obj.setTranslate(n.from_x+n.delta_x*r,n.from_y+n.delta_y*r)}}bwanimations.length>0&&requestAnimationFrame(bwstep)}if(bwdefine("bw/css-updater",["jquery"],function(t){"use strict";function e(e){for(var n=document.getElementsByTagName("link"),i=0,o=n.length;i<o;i++){var r=n[i],a=r.rel;if("string"!=typeof a||0===a.length||"stylesheet"===a){var s=r.getAttribute("href");0===s.indexOf("config")&&s.indexOf(".css")!==-1&&(r.disabled=!0)}}t("style[id='designconfig']").remove();var c=document.createElement("style");c.id="designconfig",c.type="text/css",c.appendChild(document.createTextNode(e)),document.head.appendChild(c)}window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command&&e(n.css)})}),bwdefine("bw/printer",[],function(){"use strict";window.addEventListener("message",function(t){"print"===t.data.command&&window.print()})}),bwdefine("bw/qs",[],function(){"use strict";function t(t){var e=[];if("[object Array]"===Object.prototype.toString.call(t))for(var n=0;n<t.length;++n){var i=t[n];i.length>1?e.push(encodeURIComponent(i[0])+"="+encodeURIComponent(i[1])):e.push(encodeURIComponent(i[0]))}else for(var o in t)t.hasOwnProperty(o)&&e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")}function e(t){for(var e={},n=t.split("&"),i=0;i<n.length;i++){var o=n[i].indexOf("=");if(!(o<0)){var r=[n[i].substr(0,o),n[i].substr(o+1)],a=decodeURIComponent(r[0]);if("undefined"==typeof e[a])e[a]=decodeURIComponent(r[1]);else if("string"==typeof e[a]){var s=[e[a],decodeURIComponent(r[1])];e[a]=s}else e[a].push(decodeURIComponent(r[1]))}}return e}function n(t){for(var e=[],n=t.split("&"),i=0;i<n.length;i++){var o=n[i].indexOf("=");if(o<0)e.push([n[i]]);else{var r=[n[i].substr(0,o),n[i].substr(o+1)];e.push([decodeURIComponent(r[0]),decodeURIComponent(r[1])])}}return e}function i(t){if(t.indexOf("?")===-1)return{};var n=t.replace(/[^\?]*\?/,"").replace(/#.*/,"");return e(n)}function o(t){return!t||t.length<1||"?"!==t[0]?{}:e(t.substr(1))}function r(t){return!t||t.length<1||"?"!==t[0]?[]:n(t.substr(1))}function a(t){return!t||t.length<1||"#"!==t[0]?{}:e(t.substr(1))}function s(t,e){return t.split("&").filter(function(t){return decodeURIComponent(t.split("=")[0])!==e}).join("&")}function c(t,e){return t.length>0&&("?"===t[0]||"#"===t[0])?t[0]+s(t.substring(1),e):s(t,e)}function d(t){return t=t||window.location.href,t.indexOf("#")>=0?"#"+(t.split("#")[1]||""):""}function l(e,n){for(var i=r(window.location.search),o=!1,a=0;a<i.length;++a)if(i[a][0]===e){i[a].length>1?i[a][1]=n:i[a].push(n),o=!0;break}o||i.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(i)+d())}function u(){var t=o(h),e=a(f);for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var p=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];!function(){var e=r(window.location.search),i=[],o=d();if(o.length>=1&&"#"===o[0])for(var a=n(o.substr(1)),s=0;s<a.length;++s){var c=a[s];p.indexOf(c[0])>=0?e.push(c):i.push(c)}var l=window.location.pathname;e.length>0&&(l+="?"+t(e)),i.length>0&&(l+="#"+t(i)),history.replaceState("",document.title,l)}();var f=d(),h=window.location.search;return{split:e,splitList:n,getUrlParams:i,getQueryParams:o,getParameters:u,removeQueryStringParameter:c,updateWindowQueryParameter:l,urlencode:t,getHash:d,LEGACY_HASH_PARAMETERS:p}}),bwdefine("bw/lti",["bw/qs"],function(t){"use strict";var e=t.getParameters(),n=!!e.lti_authenticated;return{isLTI:function(){return!!e.lti||!!e.lti_version},isEmbeddedLTI:function(){return!!e.lti_version},isEmbeddedLTIAuthenticated:function(){return n},setEmbeddedLTIAuthenticated:function(){n=!0,t.updateWindowQueryParameter("lti_authenticated","1")}}}),bwdefine("bw/platform",["bw/qs"],function(t){"use strict";function e(){var t=window.navigator.userAgent,e=t.indexOf("OS ");return(t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1)&&e>-1?window.Number(t.substr(e+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":navigator.userAgent.indexOf("Safari")!==-1?"ibw-platform-ipad-safari":navigator.userAgent.indexOf("BookWidgets")!==-1?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":navigator.userAgent.indexOf("PhantomJS")!==-1?"ibw-platform-osx-phantomjs":navigator.userAgent.indexOf("ibookwidgets")!==-1?"ibw-platform-osx-preview":navigator.userAgent.indexOf("Chrome")!==-1?"ibw-platform-osx-chrome":navigator.userAgent.indexOf("Safari")!==-1?"ibw-platform-osx-safari":navigator.userAgent.indexOf("Firefox")!==-1?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?navigator.userAgent.indexOf("BookWidgets")!==-1?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&navigator.userAgent.indexOf("Trident")!==-1||"Netscape"===navigator.appName&&navigator.userAgent.indexOf("Edge")!==-1?"ibw-platform-win32-ie":navigator.userAgent.indexOf("Chrome")!==-1?"ibw-platform-win32-chrome":"Microsoft Internet Explorer"===navigator.appName?"ibw-platform-win32-ie":navigator.userAgent.indexOf("Firefox")!==-1?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":navigator.userAgent.indexOf("Android")!==-1?navigator.userAgent.indexOf("Chrome")!==-1?"ibw-platform-android-chrome":"ibw-platform-android":navigator.userAgent.indexOf("CrOS")!==-1?navigator.userAgent.indexOf("Chrome")!==-1?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}return{getPlatform:n,supportsAppFeature:function(t){return!1},isPreview:function(){if(this.getPlatform().indexOf("preview")!==-1)return!0;var e=t.getUrlParams(window.location.href);return"1"===e.preview},isTopLevelPlay:function(){var e=t.getUrlParams(window.location.href);return"1"===e.toplevel},usesCredentialProxy:function(){return window.location.search.substring(1).indexOf("bwds-secure-proxy")!==-1},isTouchDevice:function(){var t=n();return t.startsWith("ibw-platform-ipad")||t.startsWith("ibw-platform-android")},isIOS:function(){return"iPad"===navigator.platform||"iPhone"===navigator.platform},isInternetExplorer:function(){return window.navigator.userAgent.indexOf("MSIE ")!==-1||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return e()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':e()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.parent}catch(t){return!0}}}}),bwdefine("bw/dialog",["bw/tr","jquery"],function(t,e){"use strict";function n(n,i,o,r,a){a=a||a+" custom_alert",o=o||t("Ok"),i=i||"Alert",n=n||"No Message to Display";var s=e("<div></div>"),c={};return c[o]=function(){if(e(this).dialog("close"),e(this).remove(),r)return void r()},s.html(n).dialog({title:i,dialogClass:"bw-dialog no-close "+a,resizable:!1,modal:!0,width:"auto",buttons:c}),s}function i(t,i,o,r){var a=n(t,i,o,function(){});return a.parent().find("button").replaceWith(e(document.createElement("a")).html(o).attr({href:r,target:"_top"}).addClass("ui-button")),a}function o(t,n,i,o,r,a){n||(n="Please confirm"),t||(t=""),r||(r="OK"),a||(a="Cancel"),e("#BwConfirmationDalog").remove();var s=e('<div id="BwConfirmationDialog"></div>'),c={};return c[r]=function(){e(this).dialog("close"),e(this).remove(),i&&i()},c[a]=function(){e(this).dialog("close"),e(this).remove(),o&&o()},s.html(t).dialog({title:n,dialogClass:"bw-dialog BwConfirmationDialog no-close",resizable:!1,modal:!0,width:500,buttons:c}),s}function r(t,i){function o(){n(r.message,r.title)}var r={message:t,title:i};if(0===e("#critical-alert-button").length){var a=e('<div id="critical-alert-button" class="bw-toolbutton"><div class="bw-icon bw-icon-critical-error"></div></div>').prependTo(e("#title-toolbar"));a.click(o)}o()}function a(t,n){var i=e("<div></div>");i.html(t).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})}return{showAlert:n,navigateAlert:i,showCriticalAlert:r,showFatalAlert:a,showConfirmationDialog:o}}),bwdefine("bw/images",["jquery"],function(t){"use strict";function e(t,e){var n=new Image;n.onload=function(){var t=this.width,n=this.height;e(t,n)},n.onerror=function(){e()},n.src=t}function n(e){e.find("img").attr({height:"",draggable:"false"}).css("max-width","100%").each(function(){var e=t(this),n=e.css("float");"left"===n?e.css({"margin-right":"10px","margin-bottom":"10px"}):"right"===n&&e.css({"margin-left":"10px","margin-bottom":"10px"})})}return{getImageSize:e,processRichTextImages:n}}),bwdefine("bw/zoomableImage",["bw/draggable","bw/tr","bw/uriEncodeImage","jquery"],function(t,e,n,i){"use strict";function o(t,e){return i('<svg class="'+t+'" xmlns="http://www.w3.org/2000/svg" version="1.1">'+e+"</svg>")}function r(t,e,n,i){return'<line x1="'+t+'" y1="'+e+'" x2="'+n+'" y2="'+i+'" />'}function a(n){var a=i(document.createElement("div")).addClass("bw-popup-zoomable-image"),s=i(document.createElement("div")).addClass("bw-zoomable-image").css({background:"black url("+n.replace(/ /g,"%20")+") no-repeat center center","background-size":"contain"}).appendTo(a);i("<div class='bw-button bw-popup-closebutton'></div>").append(i(document.createElement("div")).addClass("bw-icon-small bw-icon-close")).makeButton(e("close")).click(function(t){setTimeout(a.remove.bind(a),0)}).appendTo(a);var c=o("bw-zoomable-image-zoomin",r(14.5,4,14.5,26)+r(4,14.5,26,14.5)).appendTo(a),d=o("bw-zoomable-image-zoomout",r(4,14.5,26,14.5)).appendTo(a);t.bwMakeDragAndResizable(s,c,d),a.appendTo(i("body"))}function s(t){return t?"Contain entire picture, keep aspect ratio"===t?"contain":"Cover entire area, keep aspect ratio"===t?"cover":"No resize"===t?"":"Cover entire area with entire picture"===t?"100% 100%":"contain":"contain"}function c(t){var e,o=t.hasOwnProperty("img")?t.img:t,r=o.sources&&o.sources.length>0?n(o.sources[0].src):"",c=r;return e=t.type&&"img"!==t.type?i(document.createElement("div")).attr("role","image").css({background:(t.background||"black")+" url("+r.replace(/ /g,"%20")+") no-repeat center center","background-size":s(t.resize_policy)}):i(document.createElement("img")).attr("src",r),null!=t.alttext&&""!==t.alttext&&e.attr("alt",t.alttext),e.on("zoom",function(){a(c)}),t.disable_click||e.tapOrClick(function(){a(c)}),t.disable_press||e.hammer().on("press",function(){a(c)}),e}return{create:c,showPopup:a}}),bwdefine("touchHelpers",["bw/platform","jquery"],function(t,e){"use strict";var n=t.getPlatform();n.indexOf("android")!==-1?e.fn.extend({clickOnDraggable:function(t){return this.each(function(){var n=!1;this.ClickOnDraggableCallback=t,e(this).on("touchstart",function(t){var e=t.originalEvent?t.originalEvent:t;return 1!==e.changedTouches.length||1!==e.touches.length||e.changedTouches[1]!==e.touches[1]?void(n=!1):(n=!0,void setTimeout(function(){n&&(console.error("touch takes too long"),n=!1)},100))}),e(this).on("touchend",function(t){if(n){var e=t.originalEvent?t.originalEvent:t;if(1!==e.changedTouches.length||0!==e.touches.length)return void(n=!1);n=!1,this.ClickOnDraggableCallback()}})})}}):e.fn.extend({clickOnDraggable:function(t){return this.each(function(){e(this).click(t)})}}),n.indexOf("android")!==-1||n.indexOf("preview")!==-1||n.indexOf("phantomjs")!==-1||"ibw-platform-osx-safari"===n||"ibw-platform-osx-ibooks"===n||"ibw-platform-osx-ibooks-epub"===n?e.fn.extend({tapOrClick:function(t){return this.each(function(){e(this).click(t)})},tapOrClickOff:function(){return this.each(function(){e(this).unbind("click")})},triggerTapOrClick:function(t){return this.each(function(){e(this).trigger("click",t)})}}):e.fn.extend({tapOrClick:function(t){return this.each(function(){var n=this,i=e(this);i.addClass("epub-block"),i.find("*").each(function(){this instanceof SVGElement||e(this).addClass("epub-block")}),i.hammer?i.hammer().on("tap",function(e){t.bind(n)(e),i.blur(),e.stopImmediatePropagation()}):i.click(function(e){t.bind(n)(e),i.blur()}),i.on("keydown",function(e){var i=e.which;13!==i&&32!==i||t.bind(n)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var t=e(this);t.hammer?t.hammer().off("tap"):t.unbind("click")})},triggerTapOrClick:function(t){return this.each(function(){var n=e(this);n.hammer?n.hammer().trigger("tap",t):n.trigger("click",t)})}}),e.fn.extend({clickOrHold:function(t,n,i){return i=i||3e3,this.each(function(){var o=!1,r=null;e(this).click(function(e){o||t.bind(this)(e),o=!1}),e(this).on("keydown",function(e){var n=e.which;13!==n&&32!==n||t.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),e(this).on("mousedown touchstart",function(){var t=this;r=setTimeout(function(){r=null,o=!0,n.bind(t)()},i)}),e(this).on("mouseup touchend",function(){null!==r&&(clearTimeout(r),r=null),o&&setTimeout(function(){o=!1},400)})})}}),e.fn.extend({makeButton:function(t){t=t||{},"string"==typeof t&&(t={label:t}),this.attr({role:t.hasOwnProperty("role")?t.role:"button"});var e=this.attr("tabindex");return"undefined"!=typeof e&&e!==!1||this.attr({tabindex:"0"}),t.hasOwnProperty("label")&&this.attr({"aria-label":t.label}),t.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":t.labelledby}),this},makeLink:function(t){return this.attr({role:"link",tabindex:"0"}),t&&this.attr({"aria-label":t}),this}})}),bwdefine("bw/preventIBooksPinchClose",["bw/platform"],function(t){"use strict";return function(){"ibw-platform-ipad-ibooks"===t.getPlatform()&&(document.addEventListener("touchmove",function(t){t.preventDefault()},!1),document.addEventListener("touchstart",function(t){t.preventDefault()},!1),document.addEventListener("touchend",function(t){t.preventDefault()},!1))}}),bwdefine("bw/widget",["bw/platform","bw/qs","bw/css-updater","bw/printer","bw/dialog","bw/tr","jquery","bw/ui/components","bw/uriEncodeImage","bw/tool","bw/adaptToPageProtocol","bw/openWidget"],function(platform,qs,cssUpdater,printer,dialog,tr,$,uiComponents,uriEncodeImage,bwTool,adaptToPageProtocol,openWidget){"use strict";function getNakedURL(t){if(t.indexOf("?")===-1)return t;var e=/^([^\?]*)\?/.exec(t);if(e&&2===e.length)return e[1];throw Error("Shoudln't happen")}function setQueryParameters(t,e){if(e==={})return t;var n=getNakedURL(t),i=[];return $.each(e,function(t,e){i.push(t+"="+e)}),n+"?"+i.join("&")}function ShowBacklinkIfRequired(){var t=qs.getUrlParams(window.location.href);if(t.hasOwnProperty("backlink")){var e,n=t.backlink;e=t.hasOwnProperty("backbutton")?$('<div class="widget-backlink widget-backlink-text">&#9664; '+t.backbutton+"</div>").appendTo($("body")):$('<div class="widget-backlink widget-backlink-icon"></div>').appendTo($("body")),e.click(function(){var t=platform.getPlatform();if("ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t)console.log("Moving back by using history.back()"),window.history.back();else{var e=window.location.origin;n.startsWith(e)&&(n=n.substr(e.length)),console.log("Moving back by setting window.location to: "+n),window.location=n}})}}function centerWidgetTitle(t){if(!block_recurse_guard){var e=$("#top-container").height(),n=$(".closebutton-container"),i=$("#top-container .bw-toolbar");n.css("min-width",""),i.css("min-width","");var o=n.width(),r=i.width();if(i.css("min-width",o),n.css("min-width",r),t!==!0&&$("#top-container").height()!==e){block_recurse_guard=!0;try{window.onresize&&window.onresize()}catch(t){console.error("Error when calling onResize during centerWidgetTitle"),console.error(t)}block_recurse_guard=!1}}}function hidePopupMenu(){$("#top-container").removeClass("bw-show-popup-menu"),$("#title-toolbar").appendTo($("#top-container .bw-toolbar")),$(".bw-menu-overlay").remove()}function createPopupToolbarIfRequired(){if(!($("#menubutton").length>0)){var t=$("#top-container .bw-toolbar");if(t.children(":not(.outside-popup)").length>1){t.removeClass("bw-toolbar");var e=$(document.createElement("div")).addClass("bw-toolbar").appendTo($(".titlebar-layout"));t.find(".outside-popup").each(function(){$(this).appendTo(e)}),t.appendTo(e).addClass("bw-button-group"),$('<div id="menubutton" class="bw-toolbutton"><div class="bw-icon bw-icon-menu"></div></div>').makeButton(tr("Menu")).tapOrClick(function(){$("#top-container").hasClass("bw-show-popup-menu")?hidePopupMenu():setTimeout(function(){$("#top-container").addClass("bw-show-popup-menu");var t=$(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){t.on("click touchend",function(){setTimeout(hidePopupMenu,500)})},350);var e=$("#title-toolbar");e.appendTo(t)},100)}).appendTo(e)}}}function createTitleLayout(t,e,n){var i=$(t),o=$('<div id="container"></div>').prependTo(i).addClass("top-bottom-layout"),r=$('<div id="top-container"></div>').appendTo(o).addClass("top-container"),a=$("<div></div>").appendTo(r).addClass("titlebar-layout");return $('<div class="closebutton-container"></div>').appendTo(a),$('<div class="title-container"><span id="title"></span></div>').appendTo(a),n?$(n).addClass("bw-toolbar").appendTo(a):$('<div id="title-toolbar"></div>').addClass("bw-toolbar").appendTo(a),createPopupToolbarIfRequired(),$(e).appendTo(o).addClass("bottom-container"),centerWidgetTitle(),o}function prependToTitleToolbar(t){var e=$("#title-toolbar");t.prependTo(e),createPopupToolbarIfRequired(),centerWidgetTitle()}function openDebugWindow(){function appendOutput(t){t.appendTo(debugoutput),debugoutput[0].scrollTop=debugoutput[0].scrollHeight-debugoutput[0].getBoundingClientRect().height}function exec(str){var goodstr=str.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"');console.log(eval(goodstr)),commandlist.push(goodstr),index=commandlist.length}var debugwindow=$('<div class="bw-debug-window bw-row-container"></div>').appendTo("body"),debugoutput=$('<div class="bw-debug-output bw-row-resizing"></div>').appendTo(debugwindow);$('<div class="bw-debug-close">X</div>').tapOrClick(function(){debugwindow.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(debugwindow),console.log=function(t){appendOutput($("<p></p>").html(JSON.stringify(t)))},console.error=function(t){appendOutput($('<p style="color: red"></p>').html(JSON.stringify(t)))},window.onerror=function(t,e,n){return appendOutput($('<p style="color: red"></p>').html(t+" ("+e+":"+n+")")),!0};var debuginput=$('<input class="bw-debug-input bw-row-fixed">').appendTo(debugwindow),commandlist=[],index=0;debuginput.keypress(function(t){var e=t.keyCode?t.keyCode:t.which;13===e&&(exec(debuginput.val()),debuginput.val(""))}),debuginput.keydown(function(t){var e=t.keyCode?t.keyCode:t.which;38===e?index>0&&(--index,debuginput.val(commandlist[index])):40===e&&index<commandlist.length&&(++index,index===commandlist.length?debuginput.val(""):debuginput.val(commandlist[index]))});try{debugwindow.draggable()}catch(t){console.error("No drag support")}}function showDebugDialog(){if(!($(".bw-debug-window").length>0)){var t=$('<div class="bw-debug-wrapper"></div>').appendTo("body"),e=$('<div class="bw-debug-dialog"></div>').appendTo(t);$("<p>Enter your support key:</p>").appendTo(e);var n=$('<input placeholder="key"></input>').appendTo(e);$("<br><br>").appendTo(e),$('<button type="button">Cancel</button>').tapOrClick(function(){t.remove()}).appendTo(e),$('<button type="button">OK</button>').tapOrClick(function(){"bw-magic"===n.val()&&(openDebugWindow(),t.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(e)}}function initializeDebugSupport(t){function e(){i=0}function n(){3===++i&&(showDebugDialog(),i=0)}var i=0;t.clickOrHold(e,n,2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&openDebugWindow()}catch(t){}}function makeWidget(t){t=t||{};var e=$("body");e.addClass("bw"),t.hasOwnProperty("no-user-select")&&t["no-user-select"]===!0&&e.addClass("no-user-select");var n,i=t.layout||"";if("title_layout"===i?(n=createTitleLayout("body","#bottom-container"),n.find(".top-container").addClass("title-only")):"title_overlay_layout"===i?(n=createTitleLayout("body","#bottom-container"),n.addClass("title-overlay"),n.find(".top-container").addClass("title-only")):n="title_toolbar_layout"===i?createTitleLayout("body","#bottom-container","#title-toolbar"):$("#container"),t.hasOwnProperty("title")&&""!==t.title){var o=n.find("#title");o.html(t.title),initializeDebugSupport(o)}else{var r=n.find(".top-container");r.addClass("title-empty"),initializeDebugSupport(r)}"ibw-platform-ipad-ibooks-epub"===platform.getPlatform()&&(t.hasOwnProperty("epubBlockTouchEndCheck")||(t.epubBlockTouchEndCheck=function(t){return t.srcElement instanceof SVGElement||$(t.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(e){var n=$(window).width(),i=50;(e.layerX<i||n-e.layerX<i||t.epubBlockTouchEndCheck(e))&&e.preventDefault()},!1),t.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(e){t.epubBlockTouchStartCheck(e)&&e.preventDefault()},!1)),ShowBacklinkIfRequired()}var block_recurse_guard=!1;return $(function(){var t=$("html");t.hasClass("ibw-platform-custom")||t.addClass(platform.getPlatform())}),window.custom_alert=dialog.showAlert,window.criticalAlert=dialog.showCriticalAlert,window.bw_confirmation_dialog=dialog.showConfirmationDialog,window.tr=tr,window.getUrlParams=qs.getUrlParams,window.getNakedURL=getNakedURL,window.setQueryParameters=setQueryParameters,window.createLabeledCheckbox=uiComponents.createLabeledCheckbox,window.createProgressBar=uiComponents.createProgressBar,window.createSimpleCheckbox=uiComponents.createSimpleCheckbox,window.createNumberButtons=uiComponents.createNumberButtons,window.createSimpleRadiobutton=uiComponents.createSimpleRadiobutton,window.createLabeledRadiobutton=uiComponents.createLabeledRadiobutton,window.createProgressCircle=uiComponents.createProgressCircle,window.URIEncodeImage=uriEncodeImage,window.BWAdaptToPageProtocol=adaptToPageProtocol,window.OpenWidgetLink=openWidget,window.updateConfigCSS=bwTool.updateConfigCSS,{makeWidget:makeWidget,prependToTitleToolbar:prependToTitleToolbar,centerTitle:centerWidgetTitle}}),bwdefine("bw/tr",["config"],function(t){"use strict";return function(t){return window.bwlocalizationmap&&window.bwlocalizationmap[t]&&""!==window.bwlocalizationmap[t]?window.bwlocalizationmap[t]:t}}),bwdefine("bw/widgetsI18N",["config"],function(t){"use strict";return{getAJAXHeaders:function(){return null!=t.widget_language&&t.widget_language.length>0?{"Accept-Language":t.widget_language}:{}}}}),bwdefine("bw/uriEncodeImage",[],function(){"use strict";return function(t){function e(t){return"string"==typeof t||"object"==typeof t&&t.constructor===String}return e(t)?0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("//")?t.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(t).replace(/%2F/g,"/").replace(/'/g,"%27"):""}}),bwdefine("bw/getBase64Image",["jquery"],function(t){"use strict";return function(e,n,i){console.log("getBase64Image "+i);var o=document.createElement("canvas"),r=o.getContext("2d");if(""!==t(e).attr("src")){var a=t(e).attr("data-width"),s=t(e).attr("data-height");o.width=a,o.height=s,r.drawImage(e,0,0,a,s)}else if(n)return"BLANK";var c;if(i===!0)c=o.toDataURL("image/png");else try{var d=.9;do d-=.1,c=o.toDataURL("image/jpeg",d),console.log("Compressed jpeg size: "+c.length+" at quality "+d);while(c.length>25e4&&d>.5)}catch(t){console.log("No image/jpeg supported for toDataURL"),c=o.toDataURL("image/png")}return c}}),bwdefine("bw/logging",[],function(){"use strict";function t(t,e,n){var i=Array.prototype.slice.call(n);i.unshift(t+" ("+r[e]+"):"),console.log.apply(console,i)}function e(e,n,i){return n>=i?function(){t(e,n,arguments)}:function(){}}var n=0,i=1,o=2,r={0:"debug",1:"info",2:"error"};return{DEBUG:n,INFO:i,ERROR:o,createLogger:function(t,r){return"undefined"==typeof r&&(r=i),{debug:e(t,n,r),info:e(t,i,r),error:e(t,o,r)}}}}),bwdefine("bw/CallbackBridge",["bw/logging"],function(t){"use strict";var e=t.createLogger("CallbackBridge"),n=1,i=function(){this.id=n++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)};return i.prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},i.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},i.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},i.prototype._handleMessage=function(t){var e=this.getMessagePrefix();"object"==typeof t.data&&"string"==typeof t.data.command&&t.data.command.substr(0,e.length)===e&&(t.data.hasOwnProperty("err")?this.processCallback(t.data.command,t.data.err,t.data.data):this.processCallback(t.data.command,t.data.arg))},i.prototype.registerCallbacks=function(t,e){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:t,error:e},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},i.prototype.registerCallback=function(t,e){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:t,singleshot:!e},this.getMessagePrefix()+n+"-cb"},i.prototype.processCallback=function(t,n,i){try{var o=t.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(o){var r=o[1],a=this.callbacks[r];if(!a)return void e.error("Cannot find callback with ID "+r+" Bridge "+this.id+this.callbacks);var s;return"cb"===o[2]?(s=a.cb,s(n,i),void(a.singleshot&&delete this.callbacks[r])):(s="ok"===o[2]?a.ok:a.error,delete this.callbacks[r],void s(n))}e.error("Malformed callback: "+t)}catch(t){e.error(t)}},i}),bwdefine("bw/WindowAsyncCommandSender",["bw/CallbackBridge"],function(t){"use strict";var e=function(e,n){this.name=e,this.origin=n,this.callbackBridge=new t,this.callbackBridge.startListening()};return e.prototype.send=function(t,e,n){t.to=this.name,t.cb=this.callbackBridge.registerCallback(e,n),parent.postMessage(t,this.origin)},e}),bwdefine("bw/ProgressLogger",["bw/CallbackBridge","bw/platform","bw/logging"],function(t,e,n){"use strict";var i=n.createLogger("ProgressLogger"),o=new t;o.startListening();var r=function(t){function n(t,e){function n(){i.error("ProgressLogger: OK for:"+t)}function o(){i.error("ProgressLogger: ERROR for:",t)}var r=[],s="js2objc://progress?cmd="+t;if(e){for(var c in e)e.hasOwnProperty(c)&&r.push(c+"="+encodeURIComponent(e[c]));s+="&"+r.join("&")}a.callObjC(s,n,o)}var r=void 0!==t||"ibw-platform-ipad-bookwidgets"===e.getPlatform();t=t||function(t){var e=document.createElement("IFRAME");e.setAttribute("src",t),e.setAttribute("height","1px"),e.setAttribute("width","1px"),document.documentElement.appendChild(e),e.parentNode.removeChild(e),e=null};var a={};a.resultForCallback=function(t,e){o.processCallback(t,e)},a.runningInIframe=function(){try{return window.self!==window.parent}catch(t){return!0}},a.callObjC=function(e,n,i){var r=o.registerCallbacks(n,i),s="'"+r.ok+"'",c="'"+r.error+"'",d="ProgressLogger.resultForCallback";a.runningInIframe()&&(d="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),t(e+"&okCallbackId="+s+"&errorCallbackId="+c+"&callbackFunc="+d)},a.restart=function(){r&&n("restart")},a.registerScore=function(t,e,i,o,a){return r?(n("registerScore",{identifier:t,title:e,score:o,maxScore:i,primary:a===!0}),{lastval:o,update:function(o){return o!==this.lastval&&(n("updateScore",{identifier:t,title:e,score:o,maxScore:i,primary:a===!0}),this.lastval=o,!0)}}):{update:function(){return!1}}},a.registerBinary=function(t,e,n,i,o){return{update:function(){return!1}}},a.registerQuantity=function(t,e,i,o){return r?(n("registerQuantity",{identifier:t,title:e,quantity:i,primary:o===!0}),{lastval:i,update:function(i){return i!==this.lastval&&(n("updateQuantity",{identifier:t,title:e,quantity:i,primary:o===!0}),this.lastval=i,!0)}}):{update:function(){return!1}}};var s=0;return a.setProgress=function(t,e){if(r){var i=Math.max(0,Math.min(1,t/e));i!==s&&(n("setProgress",{progress:i}),s=i)}},a.registerSet=function(t,e,n,i){if(!r)return{registerAccess:function(){return!1}};var o=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(t+"accessed",e,0),accessesLogger:this.registerQuantity(t+"accesses",n,0),registerAccess:function(t){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(t)||(this.elements[t]=!0,this.accessedLogger.update(++this.accessedcount),o.setProgress(this.accessedcount,i)),!0}}},a};return r}),bwdefine("bw/ui/BoundingRectMixin",["lodash"],function(t){"use strict";return{getInitialState:function(){return{boundingRect:void 0,scrolledBoundingRect:void 0,initialBoundingRect:void 0}},componentDidMount:function(){window.addEventListener("resize",this.updateDimensions),this.canScroll&&window.addEventListener("scroll",this.updateDimensions,!0),this.updateDimensions()},componentWillUnmount:function(){this.canScroll&&window.removeEventListener("scroll",this.updateDimensions,!0),window.removeEventListener("resize",this.updateDimensions)},componentDidUpdate:function(){this.updateDimensions()},componentWillReceiveProps:function(){this.updateDimensions()},updateDimensions:function(){if(this.refs.top){var e=this.refs.top.getBoundingClientRect(),n=e?{top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height}:void 0,i=e?{top:e.top+window.scrollY,left:e.left+window.scrollX,bottom:e.bottom+window.scrollY,right:e.right+window.scrollX,width:e.width,height:e.height}:void 0;if(!this.state.initialBoundingRect||!t.isEqual(this.state.boundingRect,n)||!t.isEqual(this.state.scrolledBoundingRect,i)){var o={boundingRect:n,scrolledBoundingRect:i};this.state.initialBoundingRect||t.extend(o,{initialBoundingRect:n}),this.setState(o)}}}}}),bwdefine("bw/ui/Modal",["react","react-dom"],function(t,e){"use strict";if(t)return t.createClass({componentDidMount:function(){this.openModal()},componentWillReceiveProps:function(t){this.openModal(t)},componentWillUnmount:function(){this.closeModal()},renderModal:function(n){this.node||(this.node=document.createElement("div"),document.body.appendChild(this.node)),this.portal=e.unstable_renderSubtreeIntoContainer(this,t.cloneElement(n.children,{closeModal:this.closeModal}),this.node)},render:function(){return null},openModal:function(t){t=t||this.props,this.renderModal(t)},closeModal:function(){this.node&&(e.unmountComponentAtNode(this.node),document.body.removeChild(this.node)),this.portal=null,this.node=null}})}),bwdefine("bw/ui/components",["jquery","bw/tr"],function(t,e){"use strict";function n(e,n,i){
var o=t('<table class="bw-checkbox"></table>').appendTo(e),r=t("<tr></tr>").appendTo(o),a=t('<td class="bw-checkbox-cell"></td>').appendTo(r);return t('<div class="bw-checkbox-checkbox bw-icon bw-icon-accept" ></div>').appendTo(a),t('<td class="bw-button-label-cell"><div class="bw-button-label">'+n+"</div></td>").appendTo(r),o.bind("check",function(){t(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){t(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"checkbox"}).tapOrClick(function(){var e=t(this);"disabled"!==e.attr("disabled")&&("checked"===e.attr("checked")?(e.trigger("clear"),i&&i.call(e[0],!1)):(e.trigger("check"),i&&i.call(e[0],!0)))}),o.trigger("clear"),o}function i(e,n){var i={};i.parent=e,i.max=n,t('<div class="bw-progress-bar"></div>').css("left","-100%").appendTo(t(e));var o=100/n;return t('<div class="bw-progress-bar-marker"></div>').css({left:"-100%",width:o+"%"}).appendTo(t(e)),i.setProgress=function(e,n,i){n=n||400;var o=100*-(this.max-parseFloat(e))/this.max,r=t(this.parent+"> .bw-progress-bar");r.animate({left:o+"%"},n,"swing",function(){if(i)return void i()})},i.setPosition=function(e,n){n=n||400;var i=t(this.parent+"> .bw-progress-bar-marker"),o=100*parseFloat(e)/this.max;i.animate({left:o+"%"},n,"swing")},i.clear=function(){t(this.parent+" .bw-progress-bar").css("left","-100%"),t(this.parent+" .bw-progress-bar-marker").css("left","-100%")},i}function o(e,n,i){var o=t('<div class="bw-simple-checkbox bw-icon bw-icon-accept" ></div>').appendTo(t(e)),r={role:"checkbox"};return i&&(r.labelledby=i),o.bind("check",function(){t(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){t(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton(r).tapOrClick(function(){var e=t(this);"disabled"!==e.attr("disabled")&&("checked"===e.attr("checked")?(e.trigger("clear"),n&&n.call(e[0],!1)):(e.trigger("check"),n&&n.call(e[0],!0)))}),o.trigger("clear"),o}function r(n,i,o,r,a){function s(e){if(t(".buttonslot").removeClass("selected"),i<=9)t("#BS_"+e).addClass("selected");else if(e<5){t("#BS_1").removeClass("hide_number"),t("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)t("#BS_"+n).find(".number-button").html(n+1);t("#BS_"+e).addClass("selected")}else if(i-e<6){t("#BS_1").addClass("hide_number"),t("#BS_7").removeClass("hide_number");for(var o=2;o<8;++o)t("#BS_"+o).find(".number-button").html(i-8+o);t("#BS_"+(9-(i-e))).addClass("selected")}else{t("#BS_1").addClass("hide_number"),t("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)t("#BS_"+s).find(".number-button").html(s+e-3);t("#BS_4").addClass("selected")}0===e?t(r).addClass("hidden"):t(r).removeClass("hidden"),e===i-1?t(a).addClass("hidden"):t(a).removeClass("hidden")}function c(){--l,l<0&&(l=0),s(l),o(l)}function d(){++l,l>=i&&(l=i-1),s(l),o(l)}for(var l=0,u=Math.min(i,9),p=t(n),f=0;f<u;++f)t('<div class="buttonslot" id="BS_'+f+'"><div class="number-button bw-button">'+(f+1)+"</div></div>").appendTo(p).find(".number-button").makeButton().tapOrClick(function(){l=parseInt(t(this).html())-1,s(l),o(l)});return i>9&&(t('<div class="ellipsis"></div>').appendTo(t("#BS_1")),t('<div class="ellipsis"></div>').appendTo(t("#BS_7")),t("#BS_7").addClass("hide_number"),t("#BS_7").find(".number-button").html(i-1),t("#BS_8").find(".number-button").html(i)),t("#BS_0").addClass("selected"),t(r).addClass("hidden"),t(r).makeButton(e("previous")).tapOrClick(c),t(a).makeButton(e("next")).tapOrClick(d),{updateButtons:s,next:d,prev:c}}function a(e,n,i){var o=t('<div class="bw-simple-radiobutton bw-icon" ></div>').appendTo(t(e));o.bind("check",function(){t(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){t(this).attr({checked:null,"aria-checked":"false"})});var r={role:"radio"};return i&&(r.labelledby=i),o.makeButton(r).tapOrClick(function(){var e=t(this);"disabled"!==e.attr("disabled")&&("checked"===e.attr("checked")?(e.trigger("clear"),n&&n.call(e[0],!1)):(e.trigger("check"),n&&n.call(e[0],!0)))}),o.trigger("clear"),o}function s(e,n,i){var o=t('<table class="bw-radiobutton"></table>').appendTo(e),r=t("<tr></tr>").appendTo(o),a=t('<td class="bw-radiobutton-cell"></td>').appendTo(r);return t('<div class="bw-radiobutton-radiobutton bw-icon bw-icon-largedot" ></div>').appendTo(a),t('<td class="bw-button-label-cell"><div class="bw-button-label">'+n+"</div></td>").appendTo(r),o.bind("check",function(){t(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){t(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"radio"}).tapOrClick(function(){var e=t(this);"disabled"!==e.attr("disabled")&&("checked"===e.attr("checked")?(e.trigger("clear"),i&&i.call(e[0],!1)):(e.trigger("check"),i&&i.call(e[0],!0)))}),o.trigger("clear"),o}function c(e,n,i){function o(t,e){if(t===-1)return"";var n=2*Math.PI*t/i,o=2*Math.PI*(t+1)/i,r=c+Math.sin(n)*e,a=d-Math.cos(n)*e,s=c+Math.sin(o)*e,l=d-Math.cos(o)*e;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",r).replace("Y1",a).replace("X2",s).replace("Y2",l).replace("D",n).replace("R",e).replace("R",e)}function r(t){return'<path d="'+o(t,s)+'"/>'}var a={},s=30,c=40,d=40;a.id=n,a.progress=Array(i);var l=t('<div class="bw-progress-circle bw-centering-container" id="'+n+'"></div>').appendTo(t(e));t('<div class="bw-progress-circle-text bw-centered"></div>').appendTo(l);for(var u=[],p=0;p<i;++p)u.push(r(p));return t('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+u.join("")+'<path class="the marker"/></svg>').appendTo(l),a.setProgress=function(e,n){var i=t("#"+this.id+" path:nth-child("+(e+1)+")");i.attr("class",n)},a.setTextAndPosition=function(e,n){var i=t("#"+this.id+" .bw-progress-circle-text");i.animate({opacity:0},200,"swing",function(){i.html(e),i.animate({opacity:1},200)});var r=t("#"+this.id+" path.the.marker");r.animate({opacity:0},200,"swing",function(){r.attr("d",o(n,s)).animate({opacity:1},200)})},a}return{createLabeledCheckbox:n,createProgressBar:i,createSimpleCheckbox:o,createNumberButtons:r,createSimpleRadiobutton:a,createLabeledRadiobutton:s,createProgressCircle:c}}),bwdefine("bw/rewardUtils",[],function(){"use strict";return{createRewardWord:function(t,e){function n(){t.offset({top:(t.parent().outerHeight()-t.outerHeight())/2,left:(t.parent().outerWidth()-t.outerWidth())/2})}return""===e?{show:function(){},adjustPosition:function(){}}:(t.html(e),t.makeButton().tapOrClick(function(){t.hide()}),n(),{show:function(){t.show(),n(),t.addClass("animated bounceIn")},adjustPosition:n})}}}),bwdefine("bw/config",["config","jquery"],function(t,e){"use strict";return{getConfig:function(){var n=e.Deferred();return n.resolve(t),n},getConfigSync:function(){return t}}}),bwdefine("bw/addWeblinkIFrame",["jquery"],function(t){"use strict";return function(e,n,i,o){var r=o&&""!==o?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+o+"'}, '*');}, 1000);\" ":"",a=document.createElement("iframe");a.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+r+'href="'+n+'" target="_blank">&nbsp;</a></body>';e.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.write(s),a.contentWindow.document.close(),t(a).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})}}),bwdefine("bw/ui/balance-lines",[],function(){"use strict";return function(t){t.width("auto");for(var e=t.height(),n=e,i=t.width(),o=i;n===e;){var r=o-10;if(t.width(r),n=t.height(),n!==e)break;o=r}t.width(o)}}),bwdefine("bw/color-maps",[],function(){"use strict";var t={white:"#FFFFFF",black:"#010539",red:"#D34400",orange:"#F39C12",yellow:"#F1C40F",green:"#13A04E","#00de00":"#13A04E",blue:"#3498DB",purple:"#9B59B6","#bc00de":"#9B59B6",brown:"#A56D47"},e={white:"#FFFFFF",black:"#010539",red:"#C0392B",orange:"#E67E22",yellow:"#F39C12",green:"#118C44","#00de00":"#118C44",blue:"#2980B9",purple:"#8E44AD","#bc00de":"#8E44AD",brown:"#8C6239"};return{light:t,dark:e}}),bwdefine("bw/adaptToPageProtocol",[],function(){"use strict";return function(t){var e="file:";window&&window.location&&window.location.protocol&&(e=window.location.protocol);var n="";return 0===t.indexOf("http://")?n="http://":0===t.indexOf("https://")?n="https://":0===t.indexOf("//")&&(n="//"),""!==n?"file:"===e?"//"===n?"http:"+t:t:"http:"===e?t:"https:"===e?"http://"===n?t.replace("http://","https://"):t:"//"===n?"https:"+t:t:t}}),bwdefine("bw/tool",[],function(){"use strict";function t(){for(var t=0;t<n.length;++t)n[t]()}function e(e){for(var n=document.getElementsByTagName("link"),i=0,o=n.length;i<o;i++){var r=n[i],a=r.rel;if("string"!=typeof a||0===a.length||"stylesheet"===a){var s=r.getAttribute("href");0===s.indexOf("config")&&s.indexOf(".css")!==-1&&(r.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}}var n=[];return{CssUpdateCallbacks:n,updateConfigCSS:e,addAllDesignInfo:function(){"undefined"!=typeof window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){n.push(t)}}}),bwdefine("bw/load",["jquery"],function(t){"use strict";function e(e,n,i){var o=t.Deferred(),r=document.createElement("script");if(r.setAttribute("type","text/javascript"),i)for(var a in i)i.hasOwnProperty(a)&&r.setAttribute(a,i[a]);return r.setAttribute("src",e),r.onload=function(){o.resolve()},r.onerror=function(){o.reject()},"undefined"!=typeof r&&document.getElementsByTagName(n)[0].appendChild(r),o}return{loadJS:e}}),bwdefine("bw/scrollToView",[],function(){"use strict";return function(t,e){var n=t.position().top,i=t.innerHeight(),o=e.scrollTop(),r=e.innerHeight(),a=o+r;if(n+=e.scrollTop(),n<o||n+i>a){var s=n;return e.scrollTop(s),!1}return!0}}),bwdefine("bw/preloader",[],function(){"use strict";function t(t,e){var n=[],i=this.options;return i.onProgress&&t&&i.onProgress.call(this,t,e,this.completed.length),this.completed.length+this.errors.length===this.queue.length&&(n.push(this.completed),this.errors.length&&n.push(this.errors),i.onComplete.apply(this,n)),this}var e=function(t,e){this.options={pipeline:!1,auto:!0,onComplete:function(){}},e&&"object"==typeof e&&this.setOptions(e),this.addQueue(t),this.queue.length&&this.options.auto&&this.processQueue()};return e.prototype.setOptions=function(t){var e,n=this.options;for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return this},e.prototype.addQueue=function(t){return this.queue=t.slice(),this},e.prototype.reset=function(){return this.completed=[],this.errors=[],this},e.prototype.load=function(e,n){var i=new Image,o=this,r=this.options;return i.onerror=i.onabort=function(){this.onerror=this.onabort=this.onload=null,o.errors.push(e),r.onError&&r.onError.call(o,e),t.call(o,e),r.pipeline&&o.loadNext(n)},i.onload=function(){this.onerror=this.onabort=this.onload=null,o.completed.push(e),t.call(o,e,this),r.pipeline&&o.loadNext(n)},i.src=e,this},e.prototype.loadNext=function(t){return t++,this.queue[t]&&this.load(this.queue[t],t),this},e.prototype.processQueue=function(){var t=0,e=this.queue,n=e.length;if(this.reset(),this.options.pipeline)this.load(e[0],0);else for(;t<n;++t)this.load(e[t],t);return this},e}),bwdefine("bw/popuphelper",["jquery"],function(t){"use strict";return{positionPointerPopup:function(e,n,i,o,r,a,s){n.css({left:"0px",top:"0px"}).addClass("almostvisible").find(".triangle").remove();var c=i.centerx,d=i.centery,l=n.outerWidth(),u=n.outerHeight();n.removeClass("almostvisible");var p=25,f=50,h=25/Math.sqrt(2),b=o+i.x>l+e+p,g=a-i.x-i.width-o>l+e+p,w=r+i.y>u+e+p,m=s-i.y-i.height-r>u+e+p;g?(d<u/2+e&&(d=u/2+e),s-d<u/2+e&&(d=s-u/2-e),t('<div class="triangle lefttriangle"></div>').appendTo(n).css({left:0-f,top:u/2-h-(n.outerHeight()-n.height())/2+i.centery-d}),c+=l/2+i.width/2+p):b?(d<u/2+e&&(d=u/2+e),s-d<u/2+e&&(d=s-u/2-e),t('<div class="triangle righttriangle"></div>').appendTo(n).css({left:l-2*parseInt(n.css("border-right-width")),top:u/2-h-(n.outerHeight()-n.height())/2+i.centery-d}),c-=l/2+i.width/2+p):m?(c<l/2+e&&(c=l/2+e),a-c<l/2+e&&(c=a-l/2-e),t('<div class="triangle toptriangle"></div>').appendTo(n).css({left:l/2-h-(n.outerWidth()-n.width())/2+i.centerx-c,top:0-f}),d+=u/2+i.height/2+p):w&&(c<l/2+e&&(c=l/2+e),a-c<l/2+e&&(c=a-l/2-e),t('<div class="triangle bottomtriangle"></div>').appendTo(n).css({left:l/2-h-(n.outerWidth()-n.width())/2+i.centerx-c,top:u-2*parseInt(n.css("border-top-width"))}),d-=u/2+i.height/2+p);var v=Math.max(0,c-l/2),k=Math.max(0,d-u/2);n.css({left:v+"px",top:k+"px"}),n.removeClass("hidden")}}}),bwdefine("bw/throbber",["jquery"],function(t){"use strict";function e(e){function n(t){if(d||(d=t),!l){var e=360*Math.floor(t/1e3*s)/s,i="rotate("+e+"deg)";r.css({transform:i,"-webkit-transform":i,"-moz-transform":i,"-ms-transform":i}),window.requestAnimationFrame(n)}}var i=100,o=t('<div class="bw-throbber-wrapper bw-centering-container"></div>').appendTo(e),r=t('<canvas class="bw-throbber bw-centered" width="'+i+'" height="'+i+'">').appendTo(o),a=r[0].getContext("2d");a.translate(i/2,i/2);for(var s=30,c=0;c<s;++c)a.rotate(2*-Math.PI/s),a.strokeStyle="rgba(255,255,255,"+(1/s).toFixed(2)+")",a.lineWidth=3,a.moveTo(i/5,0),a.lineTo(2*i/5,0),a.stroke();var d=null,l=!1;return window.requestAnimationFrame(n),{close:function(){o.remove(),l=!0}}}return e}),bwdefine("bw/htmlEscape",[],function(){"use strict";return function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}}),bwdefine("bw/fontScaler",["jquery"],function(t){"use strict";function e(e,n){for(var i=e.find("span"),o=0;o<i.length;++o){var r=t(i[o]);if(r.width()>n)return!1}return!0}function n(e,n,i,o,r){for(var a=t(document.createElement("div")).css({position:"absolute",top:"0px",left:"0px",width:o}),s=i;s>n;s-=r){for(var c=t(document.createElement("div")).css("font-size",s+"px").attr("size",s),d=0;d<e.length;++d)t(document.createElement("span")).text(e[d]).appendTo(c),c.append(" ");c.appendTo(a)}return a}function i(n,i,o,r){for(var a=i,s=n.find("div"),c=0;c<s.length;++c){var d=t(s[c]);if(!(d.height()>r)&&e(d,o)){a=d.attr("size");break}}return parseInt(a)}function o(e,o,r,a,s,c){console.log("scaling fonts to: ",s,c);for(var d=parseInt(Math.sqrt(a-r-1))+1,l=t(document.createElement("div")).addClass(o).css({"border-width":"0px",padding:"0px"}),u=[],p=[],f=0;f<e.length;++f){var h=t(e[f]),b=h.text(),g=b.split(" ").filter(function(t){return 0!==t.length});u.push(g);var w=n(g,r,a,s,d);p.push(w),w.appendTo(l)}l.appendTo("body");for(var m=[],f=0;f<e.length;++f)m.push(i(p[f],r,s,c));l.remove(),p=[],l=t(document.createElement("div")).addClass(o);for(var f=0;f<e.length;++f){var w=n(u[f],m[f],Math.min(m[f]+d-1,a),s,1);p.push(w),w.appendTo(l)}l.appendTo("body");for(var v=[],f=0;f<e.length;++f)v.push(i(p[f],m[f],s,c));console.log(v);for(var f=0;f<e.length;++f){var h=t(e[f]);h.css("font-size",v[f]+"px")}l.remove()}return{scaleToBox:o}}),bwdefine("bw/activeCredentials",[],function(){"use strict";var t={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null};return{_creds:t,credentials:function(){return this._creds},clear:function(){this._creds=t},setCredentials:function(t){this._creds=t},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}}),bwdefine("bw/openWidget",["bw/qs","bw/dialog","bw/activeCredentials","jquery","bw/lti"],function(t,e,n,i,o){"use strict";return function(r,a){var s=t.getParameters();delete s.design,delete s.content,delete s.translation,o.isEmbeddedLTIAuthenticated()&&(s.lti_authenticated=1);var c=n.getProviderId(),d=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search;if(null==s.login_hint&&c&&""!==c&&(d+=window.location.search.length>1?"&":"?",d+="login_hint="+encodeURIComponent(c)),d+=t.getHash(),""===r||"?"===r.charAt(0))return void e.showAlert("The widget is not included.","Broken link");if(r+=r.indexOf("?")===-1?"?":"&",r+="backlink="+encodeURIComponent(d),window.bwbackbuttonlabel&&(r+="&backbutton="+encodeURIComponent(window.bwbackbuttonlabel)),r.indexOf("/play/")>=0)s.q&&""!==s.q&&(r+="&"+s.q),null!=s.toplevel&&(r+="&toplevel="+encodeURIComponent(s.toplevel)),c&&""!==c&&(r+="&login_hint="+encodeURIComponent(c));else{var l={},u={};for(var p in s)"sid"!==p&&s.hasOwnProperty(p)&&(t.LEGACY_HASH_PARAMETERS.indexOf(p)>=0?l[p]=s[p]:u[p]=s[p]);c&&""!==c&&(l.login_hint=c),Object.keys(u).length>0&&(r+="&"+t.urlencode(u)),Object.keys(l).length>0&&(r+="#"+t.urlencode(l))}if(console.log("Widget link: "+r),a){var f=i(a.target),h=f.offset(),b=f.clone();i("body").append(b),b.css({position:"absolute",left:h.left+"px",top:h.top+"px",width:f.width()+"px",height:f.height()+"px","border-left":f.css("border-left"),"border-right":f.css("border-right"),"border-top":f.css("border-top"),"border-bottom":f.css("border-bottom"),"border-top-left-radius":f.css("border-top-left-radius"),"border-top-right-radius":f.css("border-top-right-radius"),"border-bottom-left-radius":f.css("border-bottom-left-radius"),"border-bottom-right-radius":f.css("border-bottom-right-radius"),"-webkit-border-top-left-radius":f.css("-webkit-border-top-left-radius"),"-webkit-border-top-right-radius":f.css("-webkit-border-top-right-radius"),"-webkit-border-bottom-left-radius":f.css("-webkit-border-bottom-left-radius"),"-webkit-border-bottom-right-radius":f.css("-webkit-border-bottom-right-radius"),"box-shadow":f.css("box-shadow"),"-webkit-box-shadow":f.css("-webkit-box-shadow")});var g="all .5s linear";b.css({"-webkit-transition":g,"-moz-transition":g,"-o-transition":g,transition:g,"box-sizing":"border-box"});var w=i(document).width(),m=i(document).height(),v=w/f.width(),k=m/f.height(),y=v>k?k:v,x="translate("+(w/2-h.left-f.width()/2)+"px, "+(m/2-h.top-f.height()/2)+"px) scale("+y+")";b.css({"-webkit-transform":x,"-moz-transform":x,"-o-transform":x,transform:x,opacity:.1}),setTimeout(function(){window.location=r},500),f.closest("span[onclick]").attr("onclick","")}else window.location=r}}),bwdefine("bw/pictureanswerhelpers",[],function(){"use strict";function t(t){return window.location.origin+window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1)+t}return{createTextOrPictureAnswer:function(e,n){return"undefined"==typeof bwshortcode?e:{type:"Image",url:t(n),name:e}},createPairAnswer:function(e,n,i,o){return"undefined"==typeof bwshortcode?""!==i?e+" - "+i:e+" -":""===i?"undefined"==typeof n||""===n?{type:"WordPair",name1:e,name2:""}:{type:"ImageWordPair",url1:t(n),name1:e,name2:""}:"undefined"==typeof n||""===n?"undefined"==typeof o||""===o?{type:"WordPair",name1:e,name2:i}:{type:"WordImagePair",name1:e,name2:i,url2:t(o)}:"undefined"==typeof o||""===o?{type:"ImageWordPair",name1:e,url1:t(n),name2:i}:{type:"ImagePair",name1:e,url1:t(n),name2:i,url2:t(o)}},createWordListAnswer:function(e,n){if("undefined"==typeof bwshortcode){for(var i=[],o=0;o<n.length;++o)i.push(n[o].name);return e+" - "+i.join(" ")}for(var r={name:e,list:[],type:"WordImageListPair"},a=0;a<n.length;++a)"undefined"!=typeof n[a].pic&&""!==n[a].pic?r.list.push({name:n[a].name,url:t(n[a].pic)}):(r.list.push({name:n[a].name}),r.type="WordWordListPair");return r}}}),bwdefine("bw/getTextWidthCalculator",["jquery"],function(t){"use strict";return function(e,n){var i=t("<div></div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden","font-size":n,"font-family":e}).appendTo(t("body"));return{measure:function(t){return i.text(t),i.width()+1},destroy:function(){i.remove()}}}}),bwdefine("lodash",[],function(){"use strict";return window._}),bwdefine("jquery",[],function(){"use strict";return window.$}),bwdefine("blob",[],function(){"use strict";return window.Blob}),bwdefine("react",[],function(){"use strict";return window.BWReact&&window.BWReact.React}),bwdefine("react-dom",[],function(){"use strict";return window.BWReact&&window.BWReact.ReactDOM}),bwdefine("react-addons-css-transition-group",[],function(){"use strict";return window.BWReact&&window.BWReact.ReactCSSTransitionGroup}),bwdefine("react-addons-perf",[],function(){"use strict";return window.BWReact&&window.BWReact.ReactPerf}),bwdefine("react-tap-event-plugin",[],function(){"use strict";return window.BWReact&&window.BWReact.ReactTapEventPlugin}),bwdefine("mathquill",[],function(){"use strict";return window.MathQuill}),bwdefine("mathjax",[],function(){"use strict";return window.MathJax}),bwdefine("fastclick",[],function(){"use strict";return window.Origami?window.Origami.fastclick:window.FastClick?window.FastClick.attach:void 0}),bwdefine("modernizr",[],function(){"use strict";return window.Modernizr}),bwdefine("handsontable",[],function(){"use strict";return window.Handsontable}),bwdefine("hammerjs",[],function(){"use strict";return window.Hammer}),bwdefine("canvasResize",[],function(){"use strict";return window.canvasResize}),bwdefine("jsplumb",[],function(){"use strict";return window.jsPlumb}),bwdefine("three",[],function(){"use strict";return window.THREE}),bwdefine("fabric",[],function(){"use strict";return window.fabric}),bwdefine("jssorslider",[],function(){"use strict";return{$JssorArrowNavigator$:window.$JssorArrowNavigator$,$JssorSlider$:window.$JssorSlider$}}),bwdefine("autoGrowInput",["jquery"],function(t){"use strict";t.fn.autoGrowInput=function(e){return e=t.extend({maxWidth:1500,minWidth:0,comfortZone:40},e),this.filter("input:text").each(function(){var n=e.minWidth||t(this).width(),i="",o=t(this),r=t("<tester/>").css({position:"absolute",top:-9999,left:0,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap",opacity:.01}),a=function(){if(i!==(i=o.val())){var t=i.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.html(t);var a=r.width(),s=Math.min(Math.max(a+e.comfortZone,n),e.maxWidth);o.width(s)}};r.insertAfter(o),t(this).bind("keyup keydown blur update",a)}),this}}),String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)},String.prototype.endsWith=function(t){return this.indexOf(t,this.length-t.length)!==-1},"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){"use strict";for(var n=e||0,i=this.length;n<i;n++)if(this[n]===t)return n;return-1}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var nowOffset=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(nowOffset=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-nowOffset}}var bwanimations=[];jQuery.fn.extend({setTranslate:function(t,e){var n="translate("+t+"px ,"+e+"px)";this.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n})},getTranslate:function(){var t=this.css("transform");if(!(t||(t=this.css("-webkit-transform"),t||(t=this.css("-ms-transform"),t||(t=this.css("-moz-transform"))))))return{x:0,y:0};var e=t.indexOf("matrix(");if(e==-1)return{x:0,y:0};var n=t.indexOf(")",e+1);if(n==-1)return{x:0,y:0};var i=t.substring(e+7,n).split(","),o={x:parseInt(i[4]),y:parseInt(i[5])};return o},animateTranslate:function(t,e,n,i,o){var r=this.getTranslate();bwanimations.push({obj:this,duration:n,starttime:0,from_x:r.x,from_y:r.y,to_x:t,to_y:e,delta_x:t-r.x,delta_y:e-r.y,easingfunc:$.easing[i],callback:o}),1==bwanimations.length&&requestAnimationFrame(bwstep)}}),bwdefine("config",["baseconfig","jquery"],function(t,e){"use strict";function n(t){for(var e="",n=0;n<t.length;++n)e+=2*n<t.length?t.charAt(2*n):t.charAt(2*(t.length-n)-1);return e}function i(t){if("string"==typeof t)return n(t);if(e.isArray(t)){for(var o=[],r=0;r<t.length;++r)o.push(i(t[r]));return o}if("object"==typeof t){var a={};for(var s in t)t.hasOwnProperty(s)&&(a[s]=i(t[s]));return a}return t}function o(t,n){if("string"==typeof t)return t.replace(/\$RESOURCEDIR/g,n);if(e.isArray(t)){for(var i=[],r=0;r<t.length;++r)i.push(o(t[r],n));return i}if("object"==typeof t){var a={};for(var s in t)t.hasOwnProperty(s)&&(a[s]=o(t[s],n));return a}return t}var r=i(t),a="";return 0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?a=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":"widgets-eu.bookwidgets.com"===window.location.host&&(a="//widget-assets-eu.bookwidgets.com"),r=o(r,a),r.hasOwnProperty("backbutton_label")&&""!==r.backbutton_label&&(window.bwbackbuttonlabel=r.backbutton_label),"Vertical"===r.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=r.widget_language&&""!==r.widget_language&&e("html").attr("lang",r.widget_language),r.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=r.LocalizationMap),r}),bwdefine("bw/draggable",["bw/preventIBooksPinchClose","jquery","hammerjs"],function(t,e,n){"use strict";return{bwMakeDragAndResizable:function(i,o,r,a,s){function c(t){null===b&&(b={pos:i.offset(),width:i.width(),height:i.height(),center:{x:i.offset().left,y:i.offset().top}}),t&&!b.hasOwnProperty("last_rotation")&&(b.center=t.center)}function d(t){var e=t.scale;i.offset({top:b.pos.top+t.deltaY+(b.center.y-b.pos.top)*(1-e),left:b.pos.left+t.deltaX+(b.center.x-b.pos.left)*(1-e)}),i.width(b.width*e),i.height(b.height*e)}function l(t){"panstart"===t.type?c():(d(t),a&&a())}function u(t){"pinchstart"===t.type?c(t):(d(t),s&&s())}function p(){b&&(b=null,c())}function f(t){var n=i.width(),o=i.height(),r=i.position(),a=e(window).width(),c=e(window).height();i.width(n*t),i.height(o*t),i.css("left",(r.left-a/2)*t+a/2),i.css("top",(r.top-c/2)*t+c/2),s&&s()}t();var h=new n.Manager(i.get(0));h.add(new n.Pan({threshold:0,pointers:0})),h.add(new n.Pinch({threshold:0})).recognizeWith([h.get("pan")]);var b=null;h.on("hammer.input",function(t){t.isFinal&&(b=null)}),h.on("panstart panmove",l),h.on("pinchstart pinchmove",u),h.on("pinchend pinchcancel",p),o.click(function(){f(1.25)}),r.click(function(){f(.8)})}}});