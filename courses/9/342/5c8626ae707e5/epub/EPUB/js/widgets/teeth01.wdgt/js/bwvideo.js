bwdefine("BWYT",["bw/platform","jquery","bw/adaptToPageProtocol"],function(e,t,r){"use strict";var o={getParameterByNameRaw:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r="[\\?&]"+t+"=([^&#]*)",o=new RegExp(r),a=o.exec(e);return null===a?"":a[1].replace(/\+/g," ")},isYoutubeUrl:function(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,r=e.match(t);if(r&&11===r[2].length)return!0},getYoutubeId:function(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,r=e.match(t);if(r&&11===r[2].length)return r[2];var a=o.getParameterByNameRaw(e,"v");return""!==a?a:e},timeToSeconds:function(e){var t=/([0-9]+)m([0-9]+)s/,r=e.match(t);if(null===r)return 0;console.log(r);var o=60*parseInt(r[1])+parseInt(r[2]);return console.log(o),o},getYoutubeStart:function(e){var t=o.getParameterByNameRaw(e,"start");if(""!==t)return parseInt(t);var r=o.getParameterByNameRaw(e,"t");return""!==r?o.timeToSeconds(r):0},getYoutubeEnd:function(e){var t=o.getParameterByNameRaw(e,"end");return""!==t?parseInt(t):0},getInterval:function(e){var t="",r=o.getYoutubeStart(e);0!==r&&(t="&start="+r);var a=o.getYoutubeEnd(e);return 0!==a&&(t+="&end="+a),t},addPlayerIFrame:function(a,n){var i=t(a);return"ibw-platform-win32-preview"===e.getPlatform()||"ibw-platform-osx-preview"===e.getPlatform()?(i.html("<br>Youtube videos are not supported in preview mode."),void i.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"})):void i.append("<iframe seamless id='playeriframe' src='"+r("http://www.youtube.com/embed/")+o.getYoutubeId(n)+o.getInterval(n)+"'></iframe>")},youtubeplaceholdercounter:0,resolveYoutubePlaceholdersNew:function(e){var r=e.find(".youtubeplaceholder");r.each(function(){var e=t(this);if(void 0===e.attr("id")){console.log("prepare movie player");var r="YTP_"+o.youtubeplaceholdercounter++;e.attr("id",r);var a=e.attr("src");o.addPlayerIFrame("#"+r,a)}})},YouTubeLoading:!1,YouTubeVideos:[],loadYouTubePlayer:function(e,t,o){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",r("http://www.youtube.com/player_api")),document.getElementsByTagName("body")[0].appendChild(a)},pollStartVideos:function(){if(console.log("pollStartVideos()"),"undefined"!=typeof window.YT&&"undefined"!=typeof window.YT.Player){console.log("YT player ready, really playing");for(var e=0;e<o.YouTubeVideos.length;++e)o.YouTubeVideos[e]()}else setTimeout(o.pollStartVideos,100)},playYouTube:function(r,a){function n(){console.log("createYouTubeVideo() "+r+" "+i+" "+u+" "+l);var e,o=t(r),a={rel:0};0!==u&&(a.start=u),0!==l&&(a.end=l),console.log(typeof window.YT.Player),e=new window.YT.Player(r.substring(1),{height:o.height(),width:o.width(),videoId:i,playerVars:a})}var i=o.getYoutubeId(a),u=o.getYoutubeStart(a),l=o.getYoutubeEnd(a);if("ibw-platform-win32-preview"===e.getPlatform()||"ibw-platform-osx-preview"===e.getPlatform()){var d=t(r);return d.html("<br>Youtube videos are not supported in preview mode."),void d.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"})}"undefined"!=typeof window.YT&&"undefined"!=typeof window.YT.Player?n():(o.YouTubeVideos.push(n),o.YouTubeLoading||(o.YouTubeLoading="true",o.loadYouTubePlayer(),setTimeout(o.pollStartVideos,100)))},resolveYoutubePlaceholders:function(e){function a(e){return e.toLowerCase().indexOf("youtu")!==-1}function n(e){return e.toLowerCase().indexOf("vimeo")!==-1}function i(e){return e.toLowerCase().indexOf("giphy")!==-1}function u(e){var t=/.*\/(.+)\??.*/,r=e.match(t);return r?r[1]:e}function l(e){var t=/.*\/(.+)\??.*/,r=e.match(t);return r?r[1]:e}function d(e,r){var o=r.width(),a=r.height(),n=t('<div class="videodiv"></div>').css({width:o,height:a}).appendTo(r),i=t('<iframe frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>').css({width:o,height:a}).appendTo(n);return i.attr("src",e),n}function c(e,t){d(r("http://player.vimeo.com/video")+"/"+u(e),t).addClass("bw-vimeo-wrapper")}function p(e,t){d(r("http://giphy.com/embed")+"/"+l(e),t).addClass("bw-giphy-wrapper")}var s=e.find(".youtubeplaceholder");s.each(function(){var e=t(this);if(void 0===e.attr("id")){console.log("prepare movie player");var r="YTP_"+o.youtubeplaceholdercounter++;e.attr("id",r);var u=e.attr("src");a(u)?o.playYouTube("#"+r,u):n(u)?c(u,t("#"+r)):i(u)?p(u,t("#"+r)):console.error("Unsupported video URL: "+u)}})}};return o}),bwdefine("bw/vimeoPlayer",["jquery"],function(e){return{isVimeoUrl:function(e){return/https?:\/\/vimeo.com\/\d{8,}(?=\b|\/)/.test(e)},getVimeoId:function(e){var t=/.*\/(.+)\??.*/,r=e.match(t);return r?r[1]:e},play:function(t,r){return document.getElementById(t).innerHTML='<iframe class="vimeoframe" src="'+BWAdaptToPageProtocol("http://player.vimeo.com/video")+"/"+this.getVimeoId(r)+'" width="'+width+'" height="'+height+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',{setSize:function(r,o){e("#"+t+" .vimeoframe").attr({width:r,height:o})}}}}}),bwdefine("bw/mp4Player",[],function(){return{isMp4Url:function(e){},play:function(e,t){}}}),bwdefine("bw/videoPlayer",["BWYT","bw/vimeoPlayer","bw/mp4Player"],function(e,t,r){return{play:function(o,a,n){return t.isVimeoUrl(a)?t.play(o,a):r.isMp4Url(a)?r.play(o,a):e.isYoutubeUrl(a)?e.play(o,a):"youtube"===n?e.play(o,a):"vimeo"===n?t.play(o,a):null}}});